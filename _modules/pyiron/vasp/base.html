

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pyiron.vasp.base &mdash; pyiron 0.2.17.post.dev166 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/pyiron_logo.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> pyiron
          

          
            
            <img src="../../../_static/pyiron-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../source/about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/examples.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/team.html">Team</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/software.html">Collaborators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/commandline.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/citation.html">Citing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/developers.html">Contributing to pyiron</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/pyiron/pyiron/blob/master/LICENSE">License (BSD)</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pyiron.readthedocs.io/en/latest/py-modindex.html">Module index</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mpie.de/impressum">Imprint</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.mpie.de/3392182/data-protection">Data protection</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">pyiron</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../pyiron.html">pyiron</a> &raquo;</li>
        
      <li>pyiron.vasp.base</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyiron.vasp.base</h1><div class="highlight"><pre>
<span></span><span class="c1"># coding: utf-8</span>
<span class="c1"># Copyright (c) Max-Planck-Institut f端r Eisenforschung GmbH - Computational Materials Design (CM) Department</span>
<span class="c1"># Distributed under the terms of &quot;New BSD License&quot;, see the LICENSE file.</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">posixpath</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">pyiron.dft.job.generic</span> <span class="kn">import</span> <span class="n">GenericDFTJob</span>
<span class="kn">from</span> <span class="nn">pyiron.vasp.potential</span> <span class="kn">import</span> <span class="n">VaspPotential</span><span class="p">,</span> <span class="n">VaspPotentialFile</span><span class="p">,</span> <span class="n">VaspPotentialSetter</span><span class="p">,</span> <span class="n">Potcar</span>
<span class="kn">from</span> <span class="nn">pyiron.atomistics.structure.atoms</span> <span class="kn">import</span> <span class="n">Atoms</span><span class="p">,</span> <span class="n">CrystalStructure</span>
<span class="kn">from</span> <span class="nn">pyiron.base.settings.generic</span> <span class="kn">import</span> <span class="n">Settings</span>
<span class="kn">from</span> <span class="nn">pyiron.base.generic.parameters</span> <span class="kn">import</span> <span class="n">GenericParameters</span>
<span class="kn">from</span> <span class="nn">pyiron.vasp.outcar</span> <span class="kn">import</span> <span class="n">Outcar</span>
<span class="kn">from</span> <span class="nn">pyiron.vasp.procar</span> <span class="kn">import</span> <span class="n">Procar</span>
<span class="kn">from</span> <span class="nn">pyiron.vasp.structure</span> <span class="kn">import</span> <span class="n">read_atoms</span><span class="p">,</span> <span class="n">write_poscar</span><span class="p">,</span> <span class="n">vasp_sorter</span>
<span class="kn">from</span> <span class="nn">pyiron.vasp.vasprun</span> <span class="kn">import</span> <span class="n">Vasprun</span> <span class="k">as</span> <span class="n">Vr</span>
<span class="kn">from</span> <span class="nn">pyiron.vasp.vasprun</span> <span class="kn">import</span> <span class="n">VasprunError</span>
<span class="kn">from</span> <span class="nn">pyiron.vasp.volumetric_data</span> <span class="kn">import</span> <span class="n">VaspVolumetricData</span>
<span class="kn">from</span> <span class="nn">pyiron.vasp.potential</span> <span class="kn">import</span> <span class="n">get_enmax_among_species</span>
<span class="kn">from</span> <span class="nn">pyiron.dft.waves.electronic</span> <span class="kn">import</span> <span class="n">ElectronicStructure</span>
<span class="kn">from</span> <span class="nn">pyiron.dft.waves.bandstructure</span> <span class="kn">import</span> <span class="n">Bandstructure</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Sudarsan Surendralal, Felix Lochner&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;Copyright 2020, Max-Planck-Institut f端r Eisenforschung GmbH - &quot;</span>
    <span class="s2">&quot;Computational Materials Design (CM) Department&quot;</span>
<span class="p">)</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span>
<span class="n">__maintainer__</span> <span class="o">=</span> <span class="s2">&quot;Sudarsan Surendralal&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s2">&quot;surendralal@mpie.de&quot;</span>
<span class="n">__status__</span> <span class="o">=</span> <span class="s2">&quot;production&quot;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s2">&quot;Sep 1, 2017&quot;</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">()</span>


<div class="viewcode-block" id="VaspBase"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase">[docs]</a><span class="k">class</span> <span class="nc">VaspBase</span><span class="p">(</span><span class="n">GenericDFTJob</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to setup and run and analyze VASP simulations which is a derivative of pyiron.objects.job.generic.GenericJob.</span>
<span class="sd">    The functions in these modules are written in such the function names and attributes are very generic</span>
<span class="sd">    (get_structure(), molecular_dynamics(), version) but the functions are written to handle VASP specific input/output.</span>

<span class="sd">    Args:</span>
<span class="sd">        project (pyiron.project.Project instance):  Specifies the project path among other attributes</span>
<span class="sd">        job_name (str): Name of the job</span>

<span class="sd">    Attributes:</span>
<span class="sd">        input (pyiron.vasp.vasp.Input): Instance which handles the input</span>

<span class="sd">    Examples:</span>
<span class="sd">        Let&#39;s say you need to run a vasp simulation where you would like to control the input parameters manually. To</span>
<span class="sd">        set up a static dft run with Gaussian smearing and a k-point MP mesh of [6, 6, 6]. You would have to set it up</span>
<span class="sd">        as shown below:</span>

<span class="sd">        &gt;&gt;&gt; ham = VaspBase(job_name=&quot;trial_job&quot;)</span>
<span class="sd">        &gt;&gt;&gt; ham.input.incar[IBRION] = -1</span>
<span class="sd">        &gt;&gt;&gt; ham.input.incar[ISMEAR] = 0</span>
<span class="sd">        &gt;&gt;&gt; ham.input.kpoints.set_kpoints_file(size_of_mesh=[6, 6, 6])</span>

<span class="sd">        However, the according to pyiron&#39;s philosophy, it is recommended to avoid using code specific tags like IBRION,</span>
<span class="sd">        ISMEAR etc. Therefore the recommended way to set this calculation is as follows:</span>

<span class="sd">        &gt;&gt;&gt; ham = VaspBase(job_name=&quot;trial_job&quot;)</span>
<span class="sd">        &gt;&gt;&gt; ham.calc_static()</span>
<span class="sd">        &gt;&gt;&gt; ham.set_occupancy_smearing(smearing=&quot;gaussian&quot;)</span>
<span class="sd">        &gt;&gt;&gt; ham.set_kpoints(mesh=[6, 6, 6])</span>
<span class="sd">        The exact same tags as in the first examples are set automatically.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">job_name</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VaspBase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">project</span><span class="p">,</span> <span class="n">job_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sorted_indices</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span> <span class="o">=</span> <span class="n">Input</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;SYSTEM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_parser</span> <span class="o">=</span> <span class="n">Output</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_potential</span> <span class="o">=</span> <span class="n">VaspPotentialSetter</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compress_by_default</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_enmax_among_species</span> <span class="o">=</span> <span class="n">get_enmax_among_species</span>
        <span class="n">s</span><span class="o">.</span><span class="n">publication_add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">publication</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">GenericDFTJob</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">fget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@structure</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            structure:</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">GenericDFTJob</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">fset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">structure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_potential</span> <span class="o">=</span> <span class="n">VaspPotentialSetter</span><span class="p">(</span>
                <span class="n">element_lst</span><span class="o">=</span><span class="n">structure</span><span class="o">.</span><span class="n">get_species_symbols</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">potential</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_potential</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">plane_wave_cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plane wave energy cutoff in eV</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ENCUT&quot;</span><span class="p">]</span>

    <span class="nd">@plane_wave_cutoff</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">plane_wave_cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ENCUT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">exchange_correlation_functional</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The exchange correlation functional used (LDA or GGA)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">potcar</span><span class="p">[</span><span class="s2">&quot;xc&quot;</span><span class="p">]</span>

    <span class="nd">@exchange_correlation_functional</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">exchange_correlation_functional</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;PBE&quot;</span><span class="p">,</span> <span class="s2">&quot;pbe&quot;</span><span class="p">,</span> <span class="s2">&quot;GGA&quot;</span><span class="p">,</span> <span class="s2">&quot;gga&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">potcar</span><span class="p">[</span><span class="s2">&quot;xc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PBE&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;LDA&quot;</span><span class="p">,</span> <span class="s2">&quot;lda&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">potcar</span><span class="p">[</span><span class="s2">&quot;xc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;LDA&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">potcar</span><span class="p">[</span><span class="s2">&quot;xc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">spin_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True if the calculation is spin polarized</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;I_CONSTRAINED_M&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s2">&quot;Parameter&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;I_CONSTRAINED_M&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;I_CONSTRAINED_M&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@spin_constraints</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">spin_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;I_CONSTRAINED_M&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">write_electrostatic_potential</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        True if the local potential or electrostatic potential LOCPOT file is/should be written</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LVTOT&quot;</span><span class="p">])</span>

    <span class="nd">@write_electrostatic_potential</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">write_electrostatic_potential</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LVTOT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LVHAR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">write_charge_density</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        True if the charge density file CHGCAR file is/should be written</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LCHARG&quot;</span><span class="p">])</span>

    <span class="nd">@write_charge_density</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">write_charge_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LCHARG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">write_wave_funct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        True if the wave function file WAVECAR file is/should be written</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LWAVE&quot;</span><span class="p">]</span>

    <span class="nd">@write_wave_funct</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">write_wave_funct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">write_wave</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">write_wave</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;write_wave_funct, can either be True or False.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LWAVE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">write_wave</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">write_resolved_dos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        True if the resolved DOS should be written (in the vasprun.xml file)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LORBIT&quot;</span><span class="p">]</span>

    <span class="nd">@write_resolved_dos</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">write_resolved_dos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resolved_dos</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resolved_dos</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resolved_dos</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;write_resolved_dos, can either be True, False or 0, 1, 2, 5, 10, 11, 12.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LORBIT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resolved_dos</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sorted_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        How the original atom indices are ordered in the vasp format (species by species)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sorted_indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sorted_indices</span> <span class="o">=</span> <span class="n">vasp_sorter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sorted_indices</span>

    <span class="nd">@sorted_indices</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">sorted_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setter for the sorted indices</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sorted_indices</span> <span class="o">=</span> <span class="n">val</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fix_spin_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        bool: Tells if the type of constraints the spins have for this calculation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin_constraints</span>

    <span class="nd">@fix_spin_constraint</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">fix_spin_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boolean</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;The fix_spin_constraint property is not implemented for this code. &quot;</span>
            <span class="s2">&quot;Instead use ham.spin_constraints - I_CONSTRAINED_M.&quot;</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fix_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;ISYM&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s2">&quot;Parameter&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ISYM&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ISYM&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ISYM&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@fix_symmetry</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">fix_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boolean</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;The fix_symmetry property is not implemented for this code. &quot;</span>
            <span class="s2">&quot;Instead use ham.input.incar[&#39;ISYM&#39;].&quot;</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">potential_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">VaspPotential</span><span class="p">(</span>
                <span class="n">selected_atoms</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_species_symbols</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">VaspPotential</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">potential_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t list potentials unless a structure is set&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">VaspPotentialFile</span><span class="p">(</span><span class="n">xc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">potcar</span><span class="p">[</span><span class="s2">&quot;xc&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_species_symbols</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">potential_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t list potentials unless a structure is set&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">VaspPotentialFile</span><span class="p">(</span><span class="n">xc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">potcar</span><span class="p">[</span><span class="s2">&quot;xc&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">find</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_species_symbols</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">publication</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;vasp&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;Kresse1993&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Ab initio molecular dynamics for liquid metals&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;author&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Kresse, G.&quot;</span><span class="p">,</span> <span class="s2">&quot;Hafner, J.&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;journal&quot;</span><span class="p">:</span> <span class="s2">&quot;Phys. Rev. B&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="s2">&quot;47&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;issue&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;pages&quot;</span><span class="p">:</span> <span class="s2">&quot;558--561&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;numpages&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="s2">&quot;jan&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;publisher&quot;</span><span class="p">:</span> <span class="s2">&quot;American Physical Society&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;doi&quot;</span><span class="p">:</span> <span class="s2">&quot;10.1103/PhysRevB.47.558&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://link.aps.org/doi/10.1103/PhysRevB.47.558&quot;</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="s2">&quot;Kresse1996a&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Efficiency of ab-initio total energy calculations for metals and &quot;</span>
                    <span class="s2">&quot;semiconductors using a plane-wave basis set&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;journal&quot;</span><span class="p">:</span> <span class="s2">&quot;Computational Materials Science&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="s2">&quot;6&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;number&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;pages&quot;</span><span class="p">:</span> <span class="s2">&quot;15-50&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="s2">&quot;1996&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;issn&quot;</span><span class="p">:</span> <span class="s2">&quot;0927-0256&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;doi&quot;</span><span class="p">:</span> <span class="s2">&quot;10.1016/0927-0256(96)00008-0&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://www.sciencedirect.com/science/article/pii/0927025696000080&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;author&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Kresse, G.&quot;</span><span class="p">,</span> <span class="s2">&quot;Furthm端ller, J.&quot;</span><span class="p">],</span>
                <span class="p">},</span>
                <span class="s2">&quot;Kresse1996b&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Efficient iterative schemes for ab initio total-energy calculations &quot;</span>
                    <span class="s2">&quot;using a plane-wave basis set&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;author&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Kresse, G.&quot;</span><span class="p">,</span> <span class="s2">&quot;Furthm端ller, J.&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;journal&quot;</span><span class="p">:</span> <span class="s2">&quot;Phys. Rev. B&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;volume&quot;</span><span class="p">:</span> <span class="s2">&quot;54&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;issue&quot;</span><span class="p">:</span> <span class="s2">&quot;16&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;pages&quot;</span><span class="p">:</span> <span class="s2">&quot;11169--11186&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;numpages&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="s2">&quot;1996&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="s2">&quot;oct&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;publisher&quot;</span><span class="p">:</span> <span class="s2">&quot;American Physical Society&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;doi&quot;</span><span class="p">:</span> <span class="s2">&quot;10.1103/PhysRevB.54.11169&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://link.aps.org/doi/10.1103/PhysRevB.54.11169&quot;</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">}</span>
        <span class="p">}</span>

<div class="viewcode-block" id="VaspBase.set_input_to_read_only"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.set_input_to_read_only">[docs]</a>    <span class="k">def</span> <span class="nf">set_input_to_read_only</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function enforces read-only mode for the input classes, but it has to be implement in the individual</span>
<span class="sd">        classes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VaspBase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_input_to_read_only</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">read_only</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">read_only</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">potcar</span><span class="o">.</span><span class="n">read_only</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="c1"># Compatibility functions</span>
<div class="viewcode-block" id="VaspBase.write_input"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.write_input">[docs]</a>    <span class="k">def</span> <span class="nf">write_input</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call routines that generate the INCAR, POTCAR, KPOINTS and POSCAR input files</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;SYSTEM&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;pyiron_jobname&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;SYSTEM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">job_name</span>
        <span class="n">modified_elements</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">value</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_potential</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_magmoms</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_coulomb_interactions</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;CONTCAR&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart_file_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart_file_dict</span><span class="p">[</span><span class="s2">&quot;CONTCAR&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;POSCAR&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">run_mode</span><span class="o">.</span><span class="n">modal</span><span class="p">:</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="s2">&quot;The POSCAR file will be overwritten by the CONTCAR file specified in restart_file_list.&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s2">&quot;The POSCAR file will be overwritten by the CONTCAR file specified in restart_file_list.&quot;</span>
                    <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">structure</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span>
            <span class="n">modified_elements</span><span class="o">=</span><span class="n">modified_elements</span><span class="p">,</span>
        <span class="p">)</span></div>

    <span class="c1"># define routines that collect all output files</span>
<div class="viewcode-block" id="VaspBase.collect_output"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.collect_output">[docs]</a>    <span class="k">def</span> <span class="nf">collect_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collects the outputs and stores them to the hdf file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_final_structure_from_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;CONTCAR&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_final_structure_from_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;POSCAR&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_parser</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_output_parser</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span>
                <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">sorted_indices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sorted_indices</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">VaspCollectError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">aborted</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_parser</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf5</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_exclude_groups_hdf</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_exclude_nodes_hdf</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">rewrite_hdf5</span><span class="p">(</span>
                <span class="n">job_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">job_name</span><span class="p">,</span>
                <span class="n">exclude_groups</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_exclude_groups_hdf</span><span class="p">,</span>
                <span class="n">exclude_nodes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_exclude_nodes_hdf</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="VaspBase.convergence_check"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.convergence_check">[docs]</a>    <span class="k">def</span> <span class="nf">convergence_check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;IBRION&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;input/incar/data_dict&quot;</span><span class="p">][</span><span class="s2">&quot;Parameter&quot;</span><span class="p">]:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;input/incar/data_dict&quot;</span><span class="p">][</span><span class="s2">&quot;Parameter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;IBRION&quot;</span><span class="p">)</span>
            <span class="n">ibrion</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;input/incar/data_dict&quot;</span><span class="p">][</span><span class="s2">&quot;Value&quot;</span><span class="p">][</span><span class="n">ind</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ibrion</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="s2">&quot;NELM&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;input/incar/data_dict&quot;</span><span class="p">][</span><span class="s2">&quot;Parameter&quot;</span><span class="p">]:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;input/incar/data_dict&quot;</span><span class="p">][</span><span class="s2">&quot;Parameter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;NELM&quot;</span><span class="p">)</span>
            <span class="n">max_e_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;input/incar/data_dict&quot;</span><span class="p">][</span><span class="s2">&quot;Value&quot;</span><span class="p">][</span><span class="n">ind</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_e_steps</span> <span class="o">=</span> <span class="mi">60</span>
        <span class="k">if</span> <span class="s2">&quot;NSW&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;input/incar/data_dict&quot;</span><span class="p">][</span><span class="s2">&quot;Parameter&quot;</span><span class="p">]:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;input/incar/data_dict&quot;</span><span class="p">][</span><span class="s2">&quot;Parameter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;NSW&quot;</span><span class="p">)</span>
            <span class="n">max_i_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;input/incar/data_dict&quot;</span><span class="p">][</span><span class="s2">&quot;Value&quot;</span><span class="p">][</span><span class="n">ind</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_i_steps</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">scf_energies</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;output/generic/dft/scf_energy_free&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">scf_energies</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scf_energies</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;output/outcar/scf_energies&quot;</span><span class="p">]</span>
        <span class="n">e_steps_converged</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">step</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_e_steps</span> <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">scf_energies</span><span class="p">]</span>
        <span class="c1"># For calc_md() we do not care about convergence.</span>
        <span class="k">if</span> <span class="n">ibrion</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">max_i_steps</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="c1"># For calc_static only the electronic convergence matters.</span>
        <span class="k">elif</span> <span class="n">max_i_steps</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">e_steps_converged</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="c1"># For calc_minimize only the last ionic step has to be converged!</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">max_i_steps</span>
            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">scf_energies</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_i_steps</span>
            <span class="ow">and</span> <span class="n">e_steps_converged</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="VaspBase.cleanup"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.cleanup">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files_to_remove</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;WAVECAR&quot;</span><span class="p">,</span> <span class="s2">&quot;CHGCAR&quot;</span><span class="p">,</span> <span class="s2">&quot;CHG&quot;</span><span class="p">,</span> <span class="s2">&quot;vasprun.xml&quot;</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes excess files (by default: WAVECAR, CHGCAR, CHG)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">list_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_files</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">list_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files_to_remove</span><span class="p">:</span>
                <span class="n">abs_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">abs_file_path</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspBase.collect_logfiles"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.collect_logfiles">[docs]</a>    <span class="k">def</span> <span class="nf">collect_logfiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collect errors and warnings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collect_errors</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collect_warnings</span><span class="p">()</span></div>

<div class="viewcode-block" id="VaspBase.collect_warnings"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.collect_warnings">[docs]</a>    <span class="k">def</span> <span class="nf">collect_warnings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collects warnings from the VASP run</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: implement for VASP</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;collect_warnings() is not yet implemented for VASP&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspBase.collect_errors"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.collect_errors">[docs]</a>    <span class="k">def</span> <span class="nf">collect_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collects errors from the VASP run</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># error messages by VASP</span>
        <span class="n">eddrmm_error_str</span> <span class="o">=</span> <span class="s2">&quot;WARNING in EDDRMM: call to ZHEGV failed, returncode =&quot;</span>
        <span class="n">zbrent_error_str</span> <span class="o">=</span> <span class="s2">&quot;ZBRENT: fatal error in bracketing&quot;</span>

        <span class="c1"># warning messages for pyiron</span>
        <span class="n">eddrmm_warning_str</span> <span class="o">=</span> <span class="s2">&quot;EDDRMM warnings occured </span><span class="si">{}</span><span class="s2"> times, first in ionic step </span><span class="si">{}</span><span class="s2">.&quot;</span>
        <span class="n">zbrent_warning_str</span> <span class="o">=</span> <span class="s2">&quot;&#39;ZBRENT: fatal error in bracketing&#39; occured. Please check VASP manual for details.&quot;</span>
        <span class="n">warning_status_str</span> <span class="o">=</span> <span class="s2">&quot;Status is switched to &#39;warning&#39;.&quot;</span>
        <span class="n">aborted_status_str</span> <span class="o">=</span> <span class="s2">&quot;Status is switched to &#39;aborted&#39;.&quot;</span>

        <span class="c1"># collecting errors</span>
        <span class="n">num_eddrmm</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">snap_eddrmm</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">zbrent_status</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="s2">&quot;error.out&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

            <span class="c1"># EDDRMM</span>
            <span class="c1"># If the wrong convergence algorithm is chosen, we get the following error.</span>
            <span class="c1"># https://cms.mpi.univie.ac.at/vasp-forum/viewtopic.php?f=4&amp;t=17071</span>
            <span class="n">lines_where_eddrmm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">([</span><span class="n">eddrmm_error_str</span> <span class="ow">in</span> <span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">num_eddrmm</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines_where_eddrmm</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">num_eddrmm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">snap_eddrmm</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">([</span><span class="s2">&quot;E0=&quot;</span> <span class="ow">in</span> <span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[:</span><span class="n">lines_where_eddrmm</span><span class="p">[</span><span class="mi">0</span><span class="p">]]])</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>

            <span class="c1"># ZBRENT</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">zbrent_error_str</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
                    <span class="n">zbrent_status</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>

        <span class="c1"># handling and logging</span>
        <span class="k">if</span> <span class="n">zbrent_status</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">aborted</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">zbrent_warning_str</span> <span class="o">+</span> <span class="n">aborted_status_str</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">snap_eddrmm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_eddrmm_handling</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;ignore&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">eddrmm_warning_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_eddrmm</span><span class="p">,</span> <span class="n">snap_eddrmm</span><span class="p">))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_eddrmm_handling</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;warn&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">warning</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">eddrmm_warning_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_eddrmm</span><span class="p">,</span> <span class="n">snap_eddrmm</span><span class="p">)</span> <span class="o">+</span> <span class="n">warning_status_str</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_eddrmm_handling</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;restart&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">warning</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">eddrmm_warning_str</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_eddrmm</span><span class="p">,</span> <span class="n">snap_eddrmm</span><span class="p">)</span> <span class="o">+</span> <span class="n">warning_status_str</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ALGO&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;normal&quot;</span><span class="p">:</span>
                    <span class="n">ham_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_hamiltonian</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_normal&quot;</span><span class="p">)</span>
                    <span class="n">ham_new</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ALGO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Normal&quot;</span>
                    <span class="n">ham_new</span><span class="o">.</span><span class="n">set_eddrmm_handling</span><span class="p">()</span>
                    <span class="n">ham_new</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Job was restarted with &#39;ALGO&#39; = &#39;Normal&#39; to avoid EDDRMM warning.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspBase.copy_hamiltonian"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.copy_hamiltonian">[docs]</a>    <span class="k">def</span> <span class="nf">copy_hamiltonian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copies a job to new one with a different name.</span>

<span class="sd">        Args:</span>
<span class="sd">            job_name (str): Job name</span>

<span class="sd">        Returns:</span>
<span class="sd">            pyiron.vasp.vasp.Vasp: New job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ham_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart</span><span class="p">(</span><span class="n">job_name</span><span class="o">=</span><span class="n">job_name</span><span class="p">)</span>
        <span class="n">ham_new</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span>
        <span class="k">return</span> <span class="n">ham_new</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_decompress_files_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">file_compressed</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;OUTCAR.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;OUTCAR&quot;</span><span class="p">,</span> <span class="s2">&quot;gzip&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;vasprun.xml.bz2&quot;</span><span class="p">,</span> <span class="s2">&quot;vasprun.xml&quot;</span><span class="p">,</span> <span class="s2">&quot;bzip2&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;vasprun.xml.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;vasprun.xml&quot;</span><span class="p">,</span> <span class="s2">&quot;gzip&quot;</span><span class="p">],</span>
        <span class="p">]:</span>
            <span class="k">if</span> <span class="n">file_compressed</span> <span class="ow">in</span> <span class="n">files</span> <span class="ow">and</span> <span class="n">file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">_</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">mode</span><span class="p">,</span> <span class="s2">&quot;-d&quot;</span><span class="p">,</span> <span class="n">file_compressed</span><span class="p">],</span>
                    <span class="n">cwd</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span>
                    <span class="n">shell</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">universal_newlines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">files</span>

<div class="viewcode-block" id="VaspBase.from_directory"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.from_directory">[docs]</a>    <span class="k">def</span> <span class="nf">from_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The Vasp instance is created by parsing the input and output from the specified directory</span>

<span class="sd">        Args:</span>
<span class="sd">            directory (str): Path to the directory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">finished</span><span class="p">:</span>
            <span class="c1"># _ = s.top_path(directory)</span>
            <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decompress_files_in_directory</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
            <span class="n">vp_new</span> <span class="o">=</span> <span class="n">Vr</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="s2">&quot;OUTCAR&quot;</span> <span class="ow">in</span> <span class="n">files</span> <span class="ow">or</span> <span class="s2">&quot;vasprun.xml&quot;</span> <span class="ow">in</span> <span class="n">files</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;This file isn&#39;t present&quot;</span><span class="p">)</span>
                    <span class="c1"># raise AssertionError(&quot;OUTCAR/vasprun.xml should be present in order to import from directory&quot;)</span>
                <span class="k">if</span> <span class="s2">&quot;vasprun.xml&quot;</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="n">vp_new</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;vasprun.xml&quot;</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">vp_new</span><span class="o">.</span><span class="n">get_initial_structure</span><span class="p">()</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="n">VasprunError</span><span class="p">):</span>  <span class="c1"># except AssertionError:</span>
                <span class="k">pass</span>
                <span class="c1"># raise AssertionError(&quot;OUTCAR/vasprun.xml should be present in order to import from directory&quot;)</span>
            <span class="k">if</span> <span class="s2">&quot;INCAR&quot;</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">read_input</span><span class="p">(</span>
                        <span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;INCAR&quot;</span><span class="p">),</span> <span class="n">ignore_trigger</span><span class="o">=</span><span class="s2">&quot;!&quot;</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                    <span class="k">pass</span>
            <span class="k">if</span> <span class="s2">&quot;KPOINTS&quot;</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">read_input</span><span class="p">(</span>
                        <span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;KPOINTS&quot;</span><span class="p">),</span> <span class="n">ignore_trigger</span><span class="o">=</span><span class="s2">&quot;!&quot;</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                    <span class="k">pass</span>
            <span class="k">if</span> <span class="s2">&quot;POSCAR&quot;</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;POTCAR&quot;</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="n">structure</span> <span class="o">=</span> <span class="n">read_atoms</span><span class="p">(</span><span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;POSCAR&quot;</span><span class="p">),</span>
                                           <span class="n">species_from_potcar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">structure</span> <span class="o">=</span> <span class="n">read_atoms</span><span class="p">(</span><span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;POSCAR&quot;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="s2">&quot;CONTCAR&quot;</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">structure</span> <span class="o">=</span> <span class="n">read_atoms</span><span class="p">(</span><span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;CONTCAR&quot;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="s2">&quot;vasprun.xml&quot;</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">structure</span> <span class="o">=</span> <span class="n">vp_new</span><span class="o">.</span><span class="n">get_initial_structure</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unable to import job because structure not present&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">structure</span>
            <span class="c1"># Always set the sorted_indices to the original order when importing from jobs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="c1"># Read initial magnetic moments from the INCAR file and set it to the structure</span>
            <span class="n">magmom_loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s2">&quot;Parameter&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="s2">&quot;MAGMOM&quot;</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">magmom_loc</span><span class="p">):</span>
                <span class="n">init_moments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s2">&quot;Value&quot;</span><span class="p">])[</span><span class="n">magmom_loc</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s2">&quot;*&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                        <span class="n">init_moments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">()])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Values given in &quot;number_of_atoms*value&quot; format</span>
                        <span class="n">init_moments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
                            <span class="p">(</span>
                                <span class="p">[</span>
                                    <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])]</span>
                                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                                <span class="p">]</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Unable to parse initial magnetic moments from the INCAR file&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">init_moments</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">set_initial_magnetic_moments</span><span class="p">(</span><span class="n">init_moments</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Inconsistency during parsing initial magnetic moments from the INCAR file&quot;</span>
                    <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_write_chemical_formular_to_database</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_import_directory</span> <span class="o">=</span> <span class="n">directory</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">collect</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># self.to_hdf()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collect_output</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">finished</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span></div>

<div class="viewcode-block" id="VaspBase.stop_calculation"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.stop_calculation">[docs]</a>    <span class="k">def</span> <span class="nf">stop_calculation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">next_electronic_step</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call to stop the VASP calculation</span>

<span class="sd">        Args:</span>
<span class="sd">            next_electronic_step (bool): True if the next electronic step should be calculated</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="s2">&quot;STOPCAR&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">next_electronic_step</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;LSTOP = .TRUE.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;LABORT =.TRUE.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspBase.to_hdf"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.to_hdf">[docs]</a>    <span class="k">def</span> <span class="nf">to_hdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hdf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stores the instance attributes into the hdf5 file</span>

<span class="sd">        Args:</span>
<span class="sd">            hdf (pyiron.base.generic.hdfio.ProjectHDFio): The HDF file/path to write the data to</span>
<span class="sd">            group_name (str): The name of the group under which the data must be stored as</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VaspBase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">hdf</span><span class="o">=</span><span class="n">hdf</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="n">group_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_structure_to_hdf</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_parser</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf5</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspBase.from_hdf"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.from_hdf">[docs]</a>    <span class="k">def</span> <span class="nf">from_hdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hdf</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recreates instance from the hdf5 file</span>

<span class="sd">        Args:</span>
<span class="sd">            hdf (pyiron.base.generic.hdfio.ProjectHDFio): The HDF file/path to read the data from</span>
<span class="sd">            group_name (str): The name of the group under which the data must be stored as</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VaspBase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">from_hdf</span><span class="p">(</span><span class="n">hdf</span><span class="o">=</span><span class="n">hdf</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="n">group_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_structure_from_hdf</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">from_hdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf5</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="s2">&quot;output&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">list_groups</span><span class="p">()</span>
            <span class="ow">and</span> <span class="s2">&quot;structure&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">list_groups</span><span class="p">()</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_output_parser</span><span class="o">.</span><span class="n">from_hdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hdf5</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspBase.reset_output"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.reset_output">[docs]</a>    <span class="k">def</span> <span class="nf">reset_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets the output instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_parser</span> <span class="o">=</span> <span class="n">Output</span><span class="p">()</span></div>

<div class="viewcode-block" id="VaspBase.get_final_structure_from_file"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.get_final_structure_from_file">[docs]</a>    <span class="k">def</span> <span class="nf">get_final_structure_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;CONTCAR&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the final structure of the simulation usually from the CONTCAR file</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): Path to the CONTCAR file in VASP</span>

<span class="sd">        Returns:</span>
<span class="sd">            pyiron.atomistics.structure.atoms.Atoms: The final structure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">output_structure</span> <span class="o">=</span> <span class="n">read_atoms</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">input_structure</span> <span class="o">=</span> <span class="n">output_structure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IOError</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Unable to read output structure&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">input_structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">output_structure</span> <span class="o">=</span> <span class="n">read_atoms</span><span class="p">(</span>
                    <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                    <span class="n">species_list</span><span class="o">=</span><span class="n">input_structure</span><span class="o">.</span><span class="n">get_parent_symbols</span><span class="p">(),</span>
                <span class="p">)</span>
                <span class="n">input_structure</span><span class="o">.</span><span class="n">cell</span> <span class="o">=</span> <span class="n">output_structure</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">input_structure</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sorted_indices</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">output_structure</span><span class="o">.</span><span class="n">positions</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IOError</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Unable to read output structure&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">input_structure</span></div>

<div class="viewcode-block" id="VaspBase.write_magmoms"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.write_magmoms">[docs]</a>    <span class="k">def</span> <span class="nf">write_magmoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the magnetic moments in INCAR from that assigned to the species</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_initial_magnetic_moments</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()):</span>
            <span class="k">if</span> <span class="s2">&quot;ISPIN&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s2">&quot;Parameter&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ISPIN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ISPIN&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">final_cmd</span> <span class="o">=</span> <span class="s2">&quot;   &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">spinmom</span><span class="p">)</span> <span class="k">for</span> <span class="n">spinmom</span> <span class="ow">in</span> <span class="n">spin</span><span class="p">])</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spin</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span>
                        <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">spin</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">spin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_initial_magnetic_moments</span><span class="p">()[</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">sorted_indices</span>
                        <span class="p">]</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="n">s</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Magnetic Moments are: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">final_cmd</span><span class="p">))</span>
                <span class="k">if</span> <span class="s2">&quot;MAGMOM&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s2">&quot;Parameter&quot;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;MAGMOM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_cmd</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="nb">isinstance</span><span class="p">(</span><span class="n">spin</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="k">for</span> <span class="n">spin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_initial_magnetic_moments</span><span class="p">()</span>
                    <span class="p">]</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LNONCOLLINEAR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">spin_constraints</span>
                        <span class="ow">and</span> <span class="s2">&quot;M_CONSTR&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s2">&quot;Parameter&quot;</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;M_CONSTR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_cmd</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">spin_constraints</span>
                        <span class="ow">or</span> <span class="s2">&quot;M_CONSTR&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s2">&quot;Parameter&quot;</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="k">if</span> <span class="s2">&quot;ISYM&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s2">&quot;Parameter&quot;</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ISYM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">spin_constraints</span>
                        <span class="ow">and</span> <span class="s2">&quot;LAMBDA&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s2">&quot;Parameter&quot;</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="s2">&quot;LAMBDA is not specified but it is necessary for non collinear calculations.&quot;</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">spin_constraints</span>
                        <span class="ow">and</span> <span class="s2">&quot;RWIGS&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s2">&quot;Parameter&quot;</span><span class="p">]</span>
                    <span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="s2">&quot;Parameter RWIGS has to be set for spin constraint calculations&quot;</span>
                        <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin_constraints</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LNONCOLLINEAR&quot;</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Spin constraints are only avilable for non collinear calculations.&quot;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;Spin polarized calculation is switched off by the user. No magnetic moments are written.&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No magnetic moments&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspBase.set_eddrmm_handling"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.set_eddrmm_handling">[docs]</a>    <span class="k">def</span> <span class="nf">set_eddrmm_handling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">&quot;warn&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the way, how EDDRMM warning is handled.</span>

<span class="sd">        Args:</span>
<span class="sd">            status (str): new status of EDDRMM handling (can be &#39;warn&#39;, &#39;ignore&#39;, or &#39;restart&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;warn&quot;</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;ignore&quot;</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;restart&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">_eddrmm</span> <span class="o">=</span> <span class="n">status</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span></div>

<div class="viewcode-block" id="VaspBase.get_eddrmm_handling"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.get_eddrmm_handling">[docs]</a>    <span class="k">def</span> <span class="nf">get_eddrmm_handling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: status of EDDRMM handling</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">_eddrmm</span></div>

<div class="viewcode-block" id="VaspBase.set_coulomb_interactions"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.set_coulomb_interactions">[docs]</a>    <span class="k">def</span> <span class="nf">set_coulomb_interactions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interaction_type</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ldau_print</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the on-site Coulomb interactions in the INCAR file</span>

<span class="sd">        Args:</span>
<span class="sd">            interaction_type (int): Type of Coulombic interaction</span>
<span class="sd">                1 - Asimov method</span>
<span class="sd">                2 - Dudarev method</span>
<span class="sd">            ldau_print (boolean): True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj_lst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_species_objects</span><span class="p">()</span>
        <span class="n">ldaul</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ldauu</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ldauj</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">needed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">el_obj</span> <span class="ow">in</span> <span class="n">obj_lst</span><span class="p">:</span>
            <span class="n">conditions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">el_obj</span><span class="o">.</span><span class="n">tags</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ldauu&quot;</span><span class="p">,</span> <span class="s2">&quot;ldaul&quot;</span><span class="p">,</span> <span class="s2">&quot;ldauj&quot;</span><span class="p">]:</span>
                    <span class="n">conditions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span> <span class="ow">in</span> <span class="n">el_obj</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">conditions</span><span class="p">):</span>
                    <span class="n">ldaul</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;-1&quot;</span><span class="p">)</span>
                    <span class="n">ldauu</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>
                    <span class="n">ldauj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">conditions</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;All three tags ldauu,ldauj and ldaul have to be specified&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">conditions</span><span class="p">):</span>
                    <span class="n">needed</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">ldaul</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">el_obj</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s2">&quot;ldaul&quot;</span><span class="p">]))</span>
                    <span class="n">ldauu</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">el_obj</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s2">&quot;ldauu&quot;</span><span class="p">]))</span>
                    <span class="n">ldauj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">el_obj</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s2">&quot;ldauj&quot;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">needed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LDAU&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LDAUTYPE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interaction_type</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LDAUL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ldaul</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LDAUU&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ldauu</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LDAUJ&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ldauj</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ldau_print</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LDAUPRINT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No on site coulomb interactions&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspBase.set_algorithm"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.set_algorithm">[docs]</a>    <span class="k">def</span> <span class="nf">set_algorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s2">&quot;Fast&quot;</span><span class="p">,</span> <span class="n">ialgo</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the type of electronic minimization algorithm</span>

<span class="sd">        Args:</span>
<span class="sd">            algorithm (str): Algorithm defined by VASP (Fast, Normal etc.)</span>
<span class="sd">            ialgo (int): Sets the IALGO tag in VASP. If not none, this overwrites algorithm</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">algorithm_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Fast&quot;</span><span class="p">,</span> <span class="s2">&quot;Accurate&quot;</span><span class="p">,</span> <span class="s2">&quot;Normal&quot;</span><span class="p">,</span> <span class="s2">&quot;Very Fast&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ialgo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;IALGO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ialgo</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ALGO&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">algorithm</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">algorithm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">algorithm_list</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Algorithm </span><span class="si">{}</span><span class="s2"> is unusual for VASP. &quot;</span>
                    <span class="s2">&quot;I hope you know what you are up to&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algorithm</span><span class="p">)</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="VaspBase.calc_minimize"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.calc_minimize">[docs]</a>    <span class="k">def</span> <span class="nf">calc_minimize</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">electronic_steps</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
        <span class="n">ionic_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">max_iter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pressure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">algorithm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">retain_charge_density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">retain_electrostatic_potential</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ionic_energy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ionic_forces</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ionic_energy_tolerance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ionic_force_tolerance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">volume_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to setup the hamiltonian to perform ionic relaxations using DFT. The ISIF tag has to be supplied</span>
<span class="sd">        separately.</span>

<span class="sd">        Args:</span>
<span class="sd">            electronic_steps (int): Maximum number of electronic steps</span>
<span class="sd">            ionic_steps (int): Maximum number of ionic</span>
<span class="sd">            max_iter (int): Maximum number of iterations</span>
<span class="sd">            pressure (float): External pressure to be applied</span>
<span class="sd">            algorithm (str): Type of VASP algorithm to be used &quot;Fast&quot;/&quot;Accurate&quot;</span>
<span class="sd">            retain_charge_density (bool): True if the charge density should be written</span>
<span class="sd">            retain_electrostatic_potential (boolean): True if the electrostatic potential should be written</span>
<span class="sd">            ionic_energy_tolerance (float): Ionic energy convergence criteria (eV)</span>
<span class="sd">            ionic_force_tolerance (float): Ionic forces convergence criteria (overwrites ionic energy) (ev/A)</span>
<span class="sd">            ionic_energy (float): Same as ionic_energy_tolerance (deprecated)</span>
<span class="sd">            ionic_forces (float): Same as ionic_force_tolerance (deprecated)</span>
<span class="sd">            volume_only (bool): Option to relax only the volume (keeping the relative coordinates fixed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VaspBase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">calc_minimize</span><span class="p">(</span>
            <span class="n">electronic_steps</span><span class="o">=</span><span class="n">electronic_steps</span><span class="p">,</span>
            <span class="n">ionic_steps</span><span class="o">=</span><span class="n">ionic_steps</span><span class="p">,</span>
            <span class="n">max_iter</span><span class="o">=</span><span class="n">max_iter</span><span class="p">,</span>
            <span class="n">pressure</span><span class="o">=</span><span class="n">pressure</span><span class="p">,</span>
            <span class="n">algorithm</span><span class="o">=</span><span class="n">algorithm</span><span class="p">,</span>
            <span class="n">retain_charge_density</span><span class="o">=</span><span class="n">retain_charge_density</span><span class="p">,</span>
            <span class="n">retain_electrostatic_potential</span><span class="o">=</span><span class="n">retain_electrostatic_potential</span><span class="p">,</span>
            <span class="n">ionic_energy_tolerance</span><span class="o">=</span><span class="n">ionic_energy_tolerance</span><span class="p">,</span>
            <span class="n">ionic_force_tolerance</span><span class="o">=</span><span class="n">ionic_force_tolerance</span><span class="p">,</span>
            <span class="n">volume_only</span><span class="o">=</span><span class="n">volume_only</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">volume_only</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ISIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pressure</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ISIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ISIF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="k">if</span> <span class="n">max_iter</span><span class="p">:</span>
            <span class="n">electronic_steps</span> <span class="o">=</span> <span class="n">max_iter</span>
            <span class="n">ionic_steps</span> <span class="o">=</span> <span class="n">max_iter</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;IBRION&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;NELM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">electronic_steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;NSW&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ionic_steps</span>
        <span class="k">if</span> <span class="n">algorithm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_algorithm</span><span class="p">(</span><span class="n">algorithm</span><span class="o">=</span><span class="n">algorithm</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">retain_charge_density</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_charge_density</span> <span class="o">=</span> <span class="n">retain_charge_density</span>
        <span class="k">if</span> <span class="n">retain_electrostatic_potential</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_electrostatic_potential</span> <span class="o">=</span> <span class="n">retain_electrostatic_potential</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="VaspBase.calc_static"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.calc_static">[docs]</a>    <span class="k">def</span> <span class="nf">calc_static</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">electronic_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">algorithm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">retain_charge_density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">retain_electrostatic_potential</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to setup the hamiltonian to perform static SCF DFT runs.</span>

<span class="sd">        Args:</span>
<span class="sd">            electronic_steps (int): Maximum number of electronic steps</span>
<span class="sd">            algorithm (str): Type of VASP algorithm to be used &quot;Fast&quot;/&quot;Accurate&quot;</span>
<span class="sd">            retain_charge_density (bool): True if</span>
<span class="sd">            retain_electrostatic_potential (bool): True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VaspBase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">calc_static</span><span class="p">(</span>
            <span class="n">electronic_steps</span><span class="o">=</span><span class="n">electronic_steps</span><span class="p">,</span>
            <span class="n">algorithm</span><span class="o">=</span><span class="n">algorithm</span><span class="p">,</span>
            <span class="n">retain_charge_density</span><span class="o">=</span><span class="n">retain_charge_density</span><span class="p">,</span>
            <span class="n">retain_electrostatic_potential</span><span class="o">=</span><span class="n">retain_electrostatic_potential</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;IBRION&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;NELM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">electronic_steps</span>
        <span class="c1"># Make sure vasp runs only 1 ionic step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;NSW&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">algorithm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">algorithm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_algorithm</span><span class="p">(</span><span class="n">algorithm</span><span class="o">=</span><span class="n">algorithm</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">retain_charge_density</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_charge_density</span> <span class="o">=</span> <span class="n">retain_charge_density</span>
        <span class="k">if</span> <span class="n">retain_electrostatic_potential</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_electrostatic_potential</span> <span class="o">=</span> <span class="n">retain_electrostatic_potential</span></div>

<div class="viewcode-block" id="VaspBase.calc_md"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.calc_md">[docs]</a>    <span class="k">def</span> <span class="nf">calc_md</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">temperature</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">n_ionic_steps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">n_print</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">time_step</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">retain_charge_density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">retain_electrostatic_potential</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets appropriate tags for molecular dynamics in VASP</span>

<span class="sd">        Args:</span>
<span class="sd">            temperature (int/float/list): Temperature/ range of temperatures in Kelvin</span>
<span class="sd">            n_ionic_steps (int): Maximum number of ionic steps</span>
<span class="sd">            n_print (int): Prints outputs every n_print steps</span>
<span class="sd">            time_step (float): time step (fs)</span>
<span class="sd">            retain_charge_density (bool): True id the charge density should be written</span>
<span class="sd">            retain_electrostatic_potential (bool): True if the electrostatic potential should be written</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VaspBase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">calc_md</span><span class="p">(</span>
            <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>
            <span class="n">n_ionic_steps</span><span class="o">=</span><span class="n">n_ionic_steps</span><span class="p">,</span>
            <span class="n">n_print</span><span class="o">=</span><span class="n">n_print</span><span class="p">,</span>
            <span class="n">time_step</span><span class="o">=</span><span class="n">time_step</span><span class="p">,</span>
            <span class="n">retain_charge_density</span><span class="o">=</span><span class="n">retain_charge_density</span><span class="p">,</span>
            <span class="n">retain_electrostatic_potential</span><span class="o">=</span><span class="n">retain_electrostatic_potential</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># NVT ensemble</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;SMASS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;TEBEG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temperature</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;TEBEG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;TEEND&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># NVE ensemble</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;SMASS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;NSW&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_ionic_steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;NBLOCK&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_print</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;POTIM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_step</span>
        <span class="k">if</span> <span class="s2">&quot;ISYM&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ISYM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">retain_charge_density</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_charge_density</span> <span class="o">=</span> <span class="n">retain_charge_density</span>
        <span class="k">if</span> <span class="n">retain_electrostatic_potential</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_electrostatic_potential</span> <span class="o">=</span> <span class="n">retain_electrostatic_potential</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Tag </span><span class="si">{}</span><span class="s2"> not relevant for vasp&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">_set_kpoints</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">mesh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">scheme</span><span class="o">=</span><span class="s2">&quot;MP&quot;</span><span class="p">,</span>
        <span class="n">center_shift</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">symmetry_reduction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">manual_kpoints</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">reciprocal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">n_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">path_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to setup the k-points for the VASP job</span>

<span class="sd">        Args:</span>
<span class="sd">            mesh (list): Size of the mesh (in the MP scheme)</span>
<span class="sd">            scheme (str): Type of k-point generation scheme (MP/GC(gamma centered)/GP(gamma point)/Manual/Line)</span>
<span class="sd">            center_shift (list): Shifts the center of the mesh from the gamma point by the given vector</span>
<span class="sd">            symmetry_reduction (boolean): Tells if the symmetry reduction is to be applied to the k-points</span>
<span class="sd">            manual_kpoints (list/numpy.ndarray): Manual list of k-points</span>
<span class="sd">            weights(list/numpy.ndarray): Manually supplied weights to each k-point in case of the manual mode</span>
<span class="sd">            reciprocal (bool): Tells if the supplied values are in reciprocal (direct) or cartesian coordinates (in</span>
<span class="sd">            reciprocal space)</span>
<span class="sd">            kmesh_density (float): Value of the required density</span>
<span class="sd">            n_path (int): Number of points per trace part for line mode</span>
<span class="sd">            path_name (str): Name of high symmetry path used for band structure calculations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">symmetry_reduction</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ISYM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">scheme_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MP&quot;</span><span class="p">,</span> <span class="s2">&quot;GC&quot;</span><span class="p">,</span> <span class="s2">&quot;GP&quot;</span><span class="p">,</span> <span class="s2">&quot;Line&quot;</span><span class="p">,</span> <span class="s2">&quot;Manual&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">scheme</span> <span class="ow">in</span> <span class="n">scheme_list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">scheme</span> <span class="o">==</span> <span class="s2">&quot;MP&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mesh</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">kpoints</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">set_kpoints_file</span><span class="p">(</span><span class="n">size_of_mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="n">center_shift</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">scheme</span> <span class="o">==</span> <span class="s2">&quot;GC&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mesh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mesh</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">kpoints</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">set_kpoints_file</span><span class="p">(</span><span class="n">size_of_mesh</span><span class="o">=</span><span class="n">mesh</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="n">center_shift</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;Gamma centered&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">scheme</span> <span class="o">==</span> <span class="s2">&quot;GP&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">set_kpoints_file</span><span class="p">(</span><span class="n">size_of_mesh</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;Gamma Point&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">scheme</span> <span class="o">==</span> <span class="s2">&quot;Line&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n_path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">_n_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;n_path has to be defined&quot;</span><span class="p">)</span>
            <span class="n">high_symmetry_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_high_symmetry_points</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">high_symmetry_points</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;high_symmetry_points has to be defined&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">path_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">_path_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;path_name has to be defined&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">path_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_high_symmetry_path</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;path_name is not a valid key of high_symmetry_path&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">path_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">_path_name</span> <span class="o">=</span> <span class="n">path_name</span>
            <span class="k">if</span> <span class="n">n_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">_n_path</span> <span class="o">=</span> <span class="n">n_path</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">set_kpoints_file</span><span class="p">(</span>
                <span class="n">method</span><span class="o">=</span><span class="s2">&quot;Line&quot;</span><span class="p">,</span>
                <span class="n">n_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">_n_path</span><span class="p">,</span>
                <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_path_for_kpoints</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">_path_name</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">scheme</span> <span class="o">==</span> <span class="s2">&quot;Manual&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">manual_kpoints</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;For the manual mode, the kpoints list should be specified&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">manual_kpoints</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)):</span>
                        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">manual_kpoints</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">reciprocal</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="s2">&quot;Reciprocal&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="s2">&quot;Cartesian&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">kpt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">manual_kpoints</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">wt</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">wt</span> <span class="o">=</span> <span class="mf">1.0</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span>
                        <span class="n">line</span><span class="o">=</span><span class="mi">3</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span>
                        <span class="n">val</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">kpt</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">kpt</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">kpt</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">wt</span><span class="p">)]),</span>
                    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_path_for_kpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        gets the trace for k-points line mode in a VASP readable form.</span>

<span class="sd">        Args:</span>
<span class="sd">            path_name (str): Name of the path used for band structure calculation from structure instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: list of tuples of position and path name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_high_symmetry_path</span><span class="p">()[</span><span class="n">path_name</span><span class="p">]</span>

        <span class="n">k_trace</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">k_trace</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_high_symmetry_points</span><span class="p">()[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">k_trace</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_high_symmetry_points</span><span class="p">()[</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">k_trace</span>

<div class="viewcode-block" id="VaspBase.set_for_band_structure_calc"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.set_for_band_structure_calc">[docs]</a>    <span class="k">def</span> <span class="nf">set_for_band_structure_calc</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">num_points</span><span class="p">,</span> <span class="n">structure</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">read_charge_density</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up the input for a non self-consistent bandstructure calculation</span>

<span class="sd">        Args:</span>
<span class="sd">            num_points (int): Number of k-points along the total BZ path</span>
<span class="sd">            structure (atomistics.structure.atoms.Atoms instance): Structure for which the bandstructure is to be</span>
<span class="sd">                                                                       generated. (default is the input structure)</span>
<span class="sd">            read_charge_density (boolean): If True, a charge density from a previous SCF run is used (recommended)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">read_charge_density</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ICHARG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="k">if</span> <span class="n">structure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_output_parser</span><span class="o">.</span><span class="n">structure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">()</span>
            <span class="n">structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_parser</span><span class="o">.</span><span class="n">structure</span>
        <span class="n">bs_obj</span> <span class="o">=</span> <span class="n">Bandstructure</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">q_point_list</span><span class="p">,</span> <span class="p">[</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">]</span> <span class="o">=</span> <span class="n">bs_obj</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span>
            <span class="n">num_points</span><span class="o">=</span><span class="n">num_points</span><span class="p">,</span> <span class="n">path_type</span><span class="o">=</span><span class="s2">&quot;full&quot;</span>
        <span class="p">)</span>
        <span class="n">q_point_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">q_point_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_kpoints</span><span class="p">(</span>
            <span class="n">scheme</span><span class="o">=</span><span class="s2">&quot;Manual&quot;</span><span class="p">,</span>
            <span class="n">symmetry_reduction</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">manual_kpoints</span><span class="o">=</span><span class="n">q_point_list</span><span class="p">,</span>
            <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">reciprocal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="VaspBase.set_convergence_precision"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.set_convergence_precision">[docs]</a>    <span class="k">def</span> <span class="nf">set_convergence_precision</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">ionic_energy_tolerance</span><span class="o">=</span><span class="mf">1.0e-3</span><span class="p">,</span> <span class="n">electronic_energy</span><span class="o">=</span><span class="mf">1.0e-7</span><span class="p">,</span> <span class="n">ionic_force_tolerance</span><span class="o">=</span><span class="mf">1.0e-2</span><span class="p">,</span>
        <span class="n">ionic_energy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ionic_forces</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the electronic and ionic convergence precision. For ionic convergence either the energy or the force</span>
<span class="sd">        precision is required</span>

<span class="sd">        Args:</span>
<span class="sd">            ionic_energy_tolerance (float): Ionic energy convergence precision (eV)</span>
<span class="sd">            electronic_energy (float): Electronic energy convergence precision (eV)</span>
<span class="sd">            ionic_force_tolerance (float): Ionic force convergence precision (eV/A)</span>
<span class="sd">            ionic_energy (float): Same as ionic_energy_tolerance (deprecated)</span>
<span class="sd">            ionic_forces (float): Same as ionic_force_tolerance (deprecated)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ionic_forces</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;ionic_forces is deprecated as of vers. 0.3.0. It is not guaranteed to be in service in vers. 0.4.0. Use ionic_force_tolerance instead.&quot;</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span>
            <span class="p">)</span>
            <span class="n">ionic_force_tolerance</span> <span class="o">=</span> <span class="n">ionic_forces</span>
        <span class="k">if</span> <span class="n">ionic_energy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;ionic_energy is deprecated as of vers. 0.3.0. It is not guaranteed to be in service in vers. 0.4.0. Use ionic_energy_tolerance instead.&quot;</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span>
            <span class="p">)</span>
            <span class="n">ionic_energy_tolerance</span> <span class="o">=</span> <span class="n">ionic_tolerance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;EDIFF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">electronic_energy</span>
        <span class="k">if</span> <span class="n">ionic_forces</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;EDIFFG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ionic_force_tolerance</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;EDIFFG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ionic_energy_tolerance</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspBase.set_dipole_correction"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.set_dipole_correction">[docs]</a>    <span class="k">def</span> <span class="nf">set_dipole_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dipole_center</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply a dipole correction using the dipole layer method proposed by `Neugebauer &amp; Scheffler`_</span>

<span class="sd">        Args:</span>
<span class="sd">            direction (int): Direction along which the field has to be applied (0, 1, or 2)</span>
<span class="sd">            dipole_center (list/numpy.ndarray): Position of the center of the dipole (not the center of the vacuum) in</span>
<span class="sd">                                                relative coordinates</span>

<span class="sd">        .. _Neugebauer &amp; Scheffler: https://doi.org/10.1103/PhysRevB.46.16067</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_electric_field</span><span class="p">(</span>
            <span class="n">e_field</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="n">direction</span><span class="p">,</span> <span class="n">dipole_center</span><span class="o">=</span><span class="n">dipole_center</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="VaspBase.set_electric_field"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.set_electric_field">[docs]</a>    <span class="k">def</span> <span class="nf">set_electric_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e_field</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dipole_center</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set an external electric field using the dipole layer method proposed by `Neugebauer &amp; Scheffler`_</span>

<span class="sd">        Args:</span>
<span class="sd">            e_field (float): Magnitude of the external electric field (eV/A)</span>
<span class="sd">            direction (int): Direction along which the field has to be applied (0, 1, or 2)</span>
<span class="sd">            dipole_center (list/numpy.ndarray): Position of the center of the dipole (not the center of the vacuum) in</span>
<span class="sd">                                                relative coordinates</span>

<span class="sd">        .. _Neugebauer &amp; Scheffler: https://doi.org/10.1103/PhysRevB.46.16067</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">direction</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ISYM&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LORBIT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;IDIPOL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">direction</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LDIPOL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;EFIELD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">e_field</span>
        <span class="k">if</span> <span class="n">dipole_center</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;DIPOL&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">dipole_center</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspBase.set_occupancy_smearing"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.set_occupancy_smearing">[docs]</a>    <span class="k">def</span> <span class="nf">set_occupancy_smearing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">smearing</span><span class="o">=</span><span class="s2">&quot;fermi&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">ismear</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set how the finite temperature smearing is applied in determining partial occupancies</span>

<span class="sd">        Args:</span>
<span class="sd">            smearing (str): Type of smearing (fermi/gaussian etc.)</span>
<span class="sd">            width (float): Smearing width (eV)</span>
<span class="sd">            ismear (int): Directly sets the ISMEAR tag. Overwrites the smearing tag</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ismear_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;fermi&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;gaussian&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;MP&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">ismear</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ISMEAR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ismear</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ISMEAR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ismear_dict</span><span class="p">[</span><span class="n">smearing</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;SIGMA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">width</span></div>

<div class="viewcode-block" id="VaspBase.set_fft_mesh"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.set_fft_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">set_fft_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nz</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the number of points in the respective directions for the 3D FFT mesh used for computing the charge density</span>
<span class="sd">        or electrostatic potentials. In VASP, using PAW potentials, this refers to the &quot;finer fft mesh&quot;. If no values</span>
<span class="sd">        are set, the default settings from Vasp are used to set the number of grid points.</span>

<span class="sd">        Args:</span>
<span class="sd">            nx (int): Number of points on the x-grid</span>
<span class="sd">            ny (int): Number of points on the y-grid</span>
<span class="sd">            nz (int): Number of points on the z-grid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">nx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;NGXF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ny</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;NGYF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ny</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;NGZF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nz</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspBase.set_mixing_parameters"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.set_mixing_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">set_mixing_parameters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">n_pulay_steps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">density_mixing_parameter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">spin_mixing_parameter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            method (str):</span>
<span class="sd">            n_pulay_steps (int):</span>
<span class="sd">            density_mixing_parameter (float):</span>
<span class="sd">            spin_mixing_parameter (float):</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;PULAY&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;IMIX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;KERKER&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;IMIX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">n_pulay_steps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;MAXMIX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_pulay_steps</span>
        <span class="k">if</span> <span class="n">density_mixing_parameter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;AMIX&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">density_mixing_parameter</span></div>

<div class="viewcode-block" id="VaspBase.set_empty_states"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.set_empty_states">[docs]</a>    <span class="k">def</span> <span class="nf">set_empty_states</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_empty_states</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the number of empty states in the calculation</span>
<span class="sd">        Args:</span>
<span class="sd">            n_empty_states (int): Required number of empty states</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_elect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nelect</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">n_empty_states</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;NBANDS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">n_elect</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_empty_states</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspBase.get_nelect"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.get_nelect">[docs]</a>    <span class="k">def</span> <span class="nf">get_nelect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the number of electrons in the systems</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Number of electrons in the system</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">finished</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">potential</span> <span class="o">=</span> <span class="n">VaspPotentialFile</span><span class="p">(</span><span class="n">xc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">potcar</span><span class="p">[</span><span class="s2">&quot;xc&quot;</span><span class="p">])</span>
            <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">potential</span><span class="o">.</span><span class="n">find_default</span><span class="p">(</span><span class="n">el</span><span class="p">)</span><span class="o">.</span><span class="n">n_elect</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_atoms</span>
                    <span class="k">for</span> <span class="n">el</span><span class="p">,</span> <span class="n">n_atoms</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_parent_basis</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">get_number_species_atoms</span><span class="p">()</span>
                    <span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;output/generic/dft/n_elect&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="VaspBase.get_magnetic_moments"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.get_magnetic_moments">[docs]</a>    <span class="k">def</span> <span class="nf">get_magnetic_moments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iteration_step</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gives the magnetic moments of a calculation for each iteration step.</span>

<span class="sd">        Args:</span>
<span class="sd">            iteration_step (int): Step for which the structure is requested</span>

<span class="sd">        Returns:</span>
<span class="sd">            numpy.ndarray/None: array of final magmetic moments or None if no magnetic moment is given</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">spins</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;output/generic/dft/final_magmoms&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">spins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">spins</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">spins</span><span class="p">[</span><span class="n">iteration_step</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="VaspBase.get_electronic_structure"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.get_electronic_structure">[docs]</a>    <span class="k">def</span> <span class="nf">get_electronic_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the electronic structure instance from the hdf5 file</span>

<span class="sd">        Returns:</span>
<span class="sd">                pyiron.atomistics.waves.electronic.ElectronicStructure instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">finished</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ho</span><span class="p">:</span>
                <span class="n">es_obj</span> <span class="o">=</span> <span class="n">ElectronicStructure</span><span class="p">()</span>
                <span class="n">es_obj</span><span class="o">.</span><span class="n">from_hdf</span><span class="p">(</span><span class="n">ho</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">es_obj</span></div>

<div class="viewcode-block" id="VaspBase.get_charge_density"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.get_charge_density">[docs]</a>    <span class="k">def</span> <span class="nf">get_charge_density</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the charge density from the hdf5 file. This value is normalized by the volume</span>

<span class="sd">        Returns:</span>
<span class="sd">                atomistics.volumetric.generic.VolumetricData instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">finished</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ho</span><span class="p">:</span>
                <span class="n">cd_obj</span> <span class="o">=</span> <span class="n">VaspVolumetricData</span><span class="p">()</span>
                <span class="n">cd_obj</span><span class="o">.</span><span class="n">from_hdf</span><span class="p">(</span><span class="n">ho</span><span class="p">,</span> <span class="s2">&quot;charge_density&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">cd_obj</span></div>

<div class="viewcode-block" id="VaspBase.get_electrostatic_potential"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.get_electrostatic_potential">[docs]</a>    <span class="k">def</span> <span class="nf">get_electrostatic_potential</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the electrostatic potential from the hdf5 file.</span>

<span class="sd">        Returns:</span>
<span class="sd">                atomistics.volumetric.generic.VolumetricData instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">finished</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_hdf5</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ho</span><span class="p">:</span>
                <span class="n">es_obj</span> <span class="o">=</span> <span class="n">VaspVolumetricData</span><span class="p">()</span>
                <span class="n">es_obj</span><span class="o">.</span><span class="n">from_hdf</span><span class="p">(</span><span class="n">ho</span><span class="p">,</span> <span class="s2">&quot;electrostatic_potential&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">es_obj</span></div>

<div class="viewcode-block" id="VaspBase.restart"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.restart">[docs]</a>    <span class="k">def</span> <span class="nf">restart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">job_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restart a new job created from an existing Vasp calculation.</span>

<span class="sd">        Args:</span>
<span class="sd">            job_name (str): Job name</span>
<span class="sd">            job_type (str): Job type. If not specified a Vasp job type is assumed</span>

<span class="sd">        Returns:</span>
<span class="sd">            new_ham (vasp.vasp.Vasp instance): New job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_ham</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">VaspBase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">restart</span><span class="p">(</span>
            <span class="n">job_name</span><span class="o">=</span><span class="n">job_name</span><span class="p">,</span> <span class="n">job_type</span><span class="o">=</span><span class="n">job_type</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">new_ham</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
            <span class="n">new_ham</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">potcar</span><span class="p">[</span><span class="s2">&quot;xc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">potcar</span><span class="p">[</span><span class="s2">&quot;xc&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">new_ham</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;MAGMOM&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">new_ham</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;MAGMOM&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">new_ham</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;M_CONSTR&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">new_ham</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;M_CONSTR&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">new_ham</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LNONCOLLINEAR&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">new_ham</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LNONCOLLINEAR&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">new_ham</span></div>

<div class="viewcode-block" id="VaspBase.restart_for_band_structure_calculations"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.restart_for_band_structure_calculations">[docs]</a>    <span class="k">def</span> <span class="nf">restart_for_band_structure_calculations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restart a new job created from an existing Vasp calculation by reading the charge density</span>
<span class="sd">        for band structure calculations.</span>

<span class="sd">        Args:</span>
<span class="sd">            job_name (str/None): Job name</span>

<span class="sd">        Returns:</span>
<span class="sd">            new_ham (vasp.vasp.Vasp instance): New job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart_from_charge_density</span><span class="p">(</span>
            <span class="n">job_name</span><span class="o">=</span><span class="n">job_name</span><span class="p">,</span>
            <span class="n">job_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">icharg</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
            <span class="n">self_consistent_calc</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="VaspBase.get_icharg_value"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.get_icharg_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_icharg_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">icharg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">self_consistent_calc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gives the correct ICHARG value for the restart calculation.</span>

<span class="sd">        Args:</span>
<span class="sd">            icharg (int/None): If given, this value will be checked for validity and returned.</span>
<span class="sd">            self_consistent_calc (bool/None): If &#39;True&#39; returns 1, if &#39;False&#39; returns 11,</span>
<span class="sd">                if &#39;None&#39; returns based on the job either 1 or 11.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: the icharg tag</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">icharg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">self_consistent_calc</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">self_consistent_calc</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">11</span>
            <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;ICHARG&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ICHARG&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">):</span>
                <span class="k">return</span> <span class="mi">11</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">icharg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The value &#39;</span><span class="si">{}</span><span class="s2">&#39; is not a proper input for &#39;icharg&#39;. Look at VASP manual.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">icharg</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">icharg</span></div>

<div class="viewcode-block" id="VaspBase.restart_from_charge_density"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.restart_from_charge_density">[docs]</a>    <span class="k">def</span> <span class="nf">restart_from_charge_density</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">job_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">job_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">icharg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">self_consistent_calc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restart a new job created from an existing Vasp calculation by reading the charge density.</span>

<span class="sd">        Args:</span>
<span class="sd">            job_name (str/None): Job name</span>
<span class="sd">            job_type (str/None): Job type. If not specified a Vasp job type is assumed</span>
<span class="sd">            icharg (int/None): If given, this value will be checked for validity and returned.</span>
<span class="sd">            self_consistent_calc (bool/None): If &#39;True&#39; returns 1, if &#39;False&#39; returns 11,</span>
<span class="sd">                if &#39;None&#39; returns based on the job either 1 or 11.</span>

<span class="sd">        Returns:</span>
<span class="sd">            new_ham (vasp.vasp.Vasp instance): New job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_ham</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart</span><span class="p">(</span><span class="n">job_name</span><span class="o">=</span><span class="n">job_name</span><span class="p">,</span> <span class="n">job_type</span><span class="o">=</span><span class="n">job_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new_ham</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">new_ham</span><span class="o">.</span><span class="n">restart_file_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="s2">&quot;CHGCAR&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;A CHGCAR from job: </span><span class="si">{}</span><span class="s2"> is not generated and therefore it can&#39;t be read.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">job_name</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">new_ham</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ICHARG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_icharg_value</span><span class="p">(</span>
                <span class="n">icharg</span><span class="o">=</span><span class="n">icharg</span><span class="p">,</span>
                <span class="n">self_consistent_calc</span><span class="o">=</span><span class="n">self_consistent_calc</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">new_ham</span></div>

<div class="viewcode-block" id="VaspBase.append_charge_density"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.append_charge_density">[docs]</a>    <span class="k">def</span> <span class="nf">append_charge_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_specifier</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Append charge density file (CHGCAR)</span>

<span class="sd">        Args:</span>
<span class="sd">            job_specifier (str/int): name of the job or job ID</span>
<span class="sd">            path (str): path to CHGCAR file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">job_specifier</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either &#39;job_specifier&#39; or &#39;path&#39; has to be given!&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">job_specifier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">job_specifier</span><span class="o">=</span><span class="n">job_specifier</span><span class="p">)</span><span class="o">.</span><span class="n">working_directory</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;CHGCAR&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restart_file_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restart_file_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;CHGCAR&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="VaspBase.restart_from_wave_and_charge"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.restart_from_wave_and_charge">[docs]</a>    <span class="k">def</span> <span class="nf">restart_from_wave_and_charge</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">job_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">job_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">icharg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">self_consistent_calc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">istart</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restart a new job created from an existing Vasp calculation by reading the charge density and the wave</span>
<span class="sd">        function.</span>

<span class="sd">        Args:</span>
<span class="sd">            job_name (str/None): Job name</span>
<span class="sd">            job_type (str/None): Job type. If not specified a Vasp job type is assumed</span>
<span class="sd">            icharg (int/None): If given, this value will be checked for validity and returned.</span>
<span class="sd">            self_consistent_calc (bool/None): If &#39;True&#39; returns 1, if &#39;False&#39; returns 11,</span>
<span class="sd">                if &#39;None&#39; returns based on the job either 1 or 11.</span>
<span class="sd">            istart (int): Vasp ISTART tag</span>

<span class="sd">        Returns:</span>
<span class="sd">            new_ham (vasp.vasp.Vasp instance): New job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_ham</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart</span><span class="p">(</span><span class="n">job_name</span><span class="o">=</span><span class="n">job_name</span><span class="p">,</span> <span class="n">job_type</span><span class="o">=</span><span class="n">job_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new_ham</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">new_ham</span><span class="o">.</span><span class="n">restart_file_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="s2">&quot;CHGCAR&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;A CHGCAR from job: </span><span class="si">{}</span><span class="s2"> is not generated and therefore it can&#39;t be read.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">job_name</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">new_ham</span><span class="o">.</span><span class="n">restart_file_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="s2">&quot;WAVECAR&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;A WAVECAR from job: </span><span class="si">{}</span><span class="s2"> is not generated and therefore it can&#39;t be read.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">job_name</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">new_ham</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ISTART&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">istart</span>

            <span class="n">new_ham</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ICHARG&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_icharg_value</span><span class="p">(</span>
                <span class="n">icharg</span><span class="o">=</span><span class="n">icharg</span><span class="p">,</span>
                <span class="n">self_consistent_calc</span><span class="o">=</span><span class="n">self_consistent_calc</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">new_ham</span></div>

<div class="viewcode-block" id="VaspBase.compress"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.compress">[docs]</a>    <span class="k">def</span> <span class="nf">compress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files_to_compress</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compress the output files of a job object.</span>

<span class="sd">        Args:</span>
<span class="sd">            files_to_compress (list): A list of files to compress (optional)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">files_to_compress</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">files_to_compress</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">f</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_files</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;CHGCAR&quot;</span><span class="p">,</span> <span class="s2">&quot;CONTCAR&quot;</span><span class="p">,</span> <span class="s2">&quot;WAVECAR&quot;</span><span class="p">,</span> <span class="s2">&quot;STOPCAR&quot;</span><span class="p">]</span>
            <span class="p">]</span>
        <span class="c1"># delete empty files</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_files</span><span class="p">()):</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">files_to_compress</span>
                <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VaspBase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">files_to_compress</span><span class="o">=</span><span class="n">files_to_compress</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspBase.restart_from_wave_functions"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.restart_from_wave_functions">[docs]</a>    <span class="k">def</span> <span class="nf">restart_from_wave_functions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">job_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">job_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">istart</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restart a new job created from an existing Vasp calculation by reading the wave functions.</span>

<span class="sd">        Args:</span>
<span class="sd">            job_name (str/None): Job name</span>
<span class="sd">            job_type (str/None): Job type. If not specified a Vasp job type is assumed</span>
<span class="sd">            istart (int): Vasp ISTART tag</span>

<span class="sd">        Returns:</span>
<span class="sd">            new_ham (vasp.vasp.Vasp instance): New job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_ham</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restart</span><span class="p">(</span><span class="n">job_name</span><span class="o">=</span><span class="n">job_name</span><span class="p">,</span> <span class="n">job_type</span><span class="o">=</span><span class="n">job_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new_ham</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">new_ham</span><span class="o">.</span><span class="n">restart_file_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">,</span> <span class="s2">&quot;WAVECAR&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;A WAVECAR from job: </span><span class="si">{}</span><span class="s2"> is not generated and therefore it can&#39;t be read.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">job_name</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">new_ham</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;ISTART&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">istart</span>
        <span class="k">return</span> <span class="n">new_ham</span></div>

<div class="viewcode-block" id="VaspBase.append_wave_function"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.append_wave_function">[docs]</a>    <span class="k">def</span> <span class="nf">append_wave_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_specifier</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Append wave function file (WAVECAR)</span>

<span class="sd">        Args:</span>
<span class="sd">            job_specifier (str/int): name of the job or job ID</span>
<span class="sd">            path (str): path to WAVECAR file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">job_specifier</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either &#39;job_specifier&#39; or &#39;path&#39; has to be given!&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">job_specifier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">inspect</span><span class="p">(</span><span class="n">job_specifier</span><span class="o">=</span><span class="n">job_specifier</span><span class="p">)</span><span class="o">.</span><span class="n">working_directory</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;WAVECAR&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restart_file_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restart_file_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;WAVECAR&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="VaspBase.set_rwigs"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.set_rwigs">[docs]</a>    <span class="k">def</span> <span class="nf">set_rwigs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rwigs_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the radii of Wigner-Seitz cell. (RWIGS tag)</span>

<span class="sd">        Args:</span>
<span class="sd">            rwigs_dict (dict): Dictionary of species and corresponding radii.</span>
<span class="sd">                (structure has to be defined before)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rwigs_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;&#39;rwigs_dict&#39; has to be a dict!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">rwigs_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The values of &#39;rwigs_dict&#39; has to be floats!&quot;</span><span class="p">)</span>
        <span class="n">species_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_number_species_atoms</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">rwigs_keys</span> <span class="o">=</span> <span class="n">rwigs_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">species_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rwigs_keys</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; is not in rwigs_dict!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>

        <span class="n">rwigs</span> <span class="o">=</span> <span class="p">[</span><span class="n">rwigs_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">species_keys</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;RWIGS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">rwigs</span><span class="p">))</span></div>

<div class="viewcode-block" id="VaspBase.get_rwigs"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.get_rwigs">[docs]</a>    <span class="k">def</span> <span class="nf">get_rwigs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the radii of Wigner-Seitz cell. (RWIGS tag)</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: dictionary of radii</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;RWIGS&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s2">&quot;Parameter&quot;</span><span class="p">]:</span>
            <span class="n">species_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">get_number_species_atoms</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">rwigs</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;RWIGS&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
            <span class="n">rwigs_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">species_keys</span><span class="p">):</span>
                <span class="n">rwigs_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">rwigs</span><span class="p">[</span><span class="n">i</span><span class="p">]})</span>
            <span class="k">return</span> <span class="n">rwigs_dict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="VaspBase.set_spin_constraint"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.set_spin_constraint">[docs]</a>    <span class="k">def</span> <span class="nf">set_spin_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lamb</span><span class="p">,</span> <span class="n">rwigs_dict</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets spin constrains including &#39;LAMBDA&#39; and &#39;RWIGS&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            lamb (float): LAMBDA tag</span>
<span class="sd">            rwigs_dict (dict): Dictionary of species and corresponding radii.</span>
<span class="sd">                (structure has to be defined before)</span>
<span class="sd">            direction (bool): (True/False) constrain spin direction.</span>
<span class="sd">            norm (bool): (True/False) constrain spin norm (magnitude).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">direction</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;&#39;direction&#39; has to be a bool!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">norm</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;&#39;lamb&#39; has to be a bool!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lamb</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;&#39;lamb&#39; has to be a float!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="ow">and</span> <span class="n">norm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;I_CONSTRAINED_M&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">direction</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;I_CONSTRAINED_M&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">norm</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Constraining norm only is not possible.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You have to constrain either direction or norm and direction.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">incar</span><span class="p">[</span><span class="s2">&quot;LAMBDA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lamb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_rwigs</span><span class="p">(</span><span class="n">rwigs_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="VaspBase.validate_ready_to_run"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.validate_ready_to_run">[docs]</a>    <span class="k">def</span> <span class="nf">validate_ready_to_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VaspBase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">validate_ready_to_run</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;spin_constraint&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">_tag_list</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;The spin_constraint tag is not supported by VASP.&quot;</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="VaspBase.list_potentials"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspBase.list_potentials">[docs]</a>    <span class="k">def</span> <span class="nf">list_potentials</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lists all the possible POTCAR files for the elements in the structure depending on the XC functional</span>

<span class="sd">        Returns:</span>
<span class="sd">           list: a list of available potentials</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">potential_list</span></div>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="Input"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.Input">[docs]</a><span class="k">class</span> <span class="nc">Input</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handles setting the input parameters for a VASP job.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        incar: .vasp.vasp.Incar instance to handle the INCAR file inputs in VASP</span>
<span class="sd">        kpoints: vasp.vasp.Kpoints instance to handle the KPOINTS file inputs in VASP</span>
<span class="sd">        potcar: vasp.vasp.Potcar instance to set the appropriate POTCAR files for the simulation</span>

<span class="sd">    Ideally, the user would not have to access the Input instance unless the user wants to set an extremely specific</span>
<span class="sd">    VASP tag which can&#39;t se set using functions in Vasp().</span>

<span class="sd">    Examples:</span>

<span class="sd">        &gt;&gt;&gt; atoms =  CrystalStructure(&quot;Pt&quot;, BravaisBasis=&quot;fcc&quot;, a=3.98)</span>
<span class="sd">        &gt;&gt;&gt; ham = VaspBase(&quot;trial&quot;)</span>
<span class="sd">        &gt;&gt;&gt; ham.structure = atoms</span>
<span class="sd">        &gt;&gt;&gt; ham.calc_static()</span>
<span class="sd">        &gt;&gt;&gt; assert(atoms==ham.structure)</span>
<span class="sd">        &gt;&gt;&gt; assert(ham.input.incar[&quot;ISIF&quot;]==-1)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incar</span> <span class="o">=</span> <span class="n">Incar</span><span class="p">(</span><span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;incar&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span> <span class="o">=</span> <span class="n">Kpoints</span><span class="p">(</span><span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;kpoints&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potcar</span> <span class="o">=</span> <span class="n">Potcar</span><span class="p">(</span><span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;potcar&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_eddrmm</span> <span class="o">=</span> <span class="s2">&quot;warn&quot;</span>

<div class="viewcode-block" id="Input.write"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.Input.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">,</span> <span class="n">modified_elements</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes all the input files to a specified directory</span>

<span class="sd">        Args:</span>
<span class="sd">            structure (atomistics.structure.atoms.Atoms instance): Structure to be written</span>
<span class="sd">            directory (str): The working directory for the VASP run</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;INCAR&quot;</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;KPOINTS&quot;</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potcar</span><span class="o">.</span><span class="n">potcar_set_structure</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">modified_elements</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potcar</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="s2">&quot;POTCAR&quot;</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">directory</span><span class="p">)</span>
        <span class="c1"># Write the species info in the POSCAR file only if there are no user defined species</span>
        <span class="n">is_user_defined</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">structure</span><span class="o">.</span><span class="n">get_species_objects</span><span class="p">():</span>
            <span class="n">is_user_defined</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">species</span><span class="o">.</span><span class="n">Parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">do_not_write_species</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">is_user_defined</span><span class="p">)</span>
        <span class="n">write_poscar</span><span class="p">(</span>
            <span class="n">structure</span><span class="p">,</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;POSCAR&quot;</span><span class="p">),</span>
            <span class="n">write_species</span><span class="o">=</span><span class="ow">not</span> <span class="n">do_not_write_species</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Input.to_hdf"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.Input.to_hdf">[docs]</a>    <span class="k">def</span> <span class="nf">to_hdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hdf</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the object in a HDF5 file</span>

<span class="sd">        Args:</span>
<span class="sd">            hdf (pyiron.base.generic.hdfio.ProjectHDFio): HDF path to which the object is to be saved</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">hdf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_input</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">hdf5_input</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">hdf5_input</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">potcar</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">hdf5_input</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;vasp_dict&quot;</span> <span class="ow">in</span> <span class="n">hdf5_input</span><span class="o">.</span><span class="n">list_nodes</span><span class="p">():</span>
                <span class="n">vasp_dict</span> <span class="o">=</span> <span class="n">hdf5_input</span><span class="p">[</span><span class="s2">&quot;vasp_dict&quot;</span><span class="p">]</span>
                <span class="n">vasp_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;eddrmm_handling&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eddrmm</span><span class="p">})</span>
                <span class="n">hdf5_input</span><span class="p">[</span><span class="s2">&quot;vasp_dict&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vasp_dict</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vasp_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;eddrmm_handling&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eddrmm</span><span class="p">}</span>
                <span class="n">hdf5_input</span><span class="p">[</span><span class="s2">&quot;vasp_dict&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vasp_dict</span></div>

<div class="viewcode-block" id="Input.from_hdf"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.Input.from_hdf">[docs]</a>    <span class="k">def</span> <span class="nf">from_hdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hdf</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the attributes and reconstructs the object from a hdf file</span>

<span class="sd">        Args:</span>
<span class="sd">            hdf: The hdf5 instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">hdf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_input</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">incar</span><span class="o">.</span><span class="n">from_hdf</span><span class="p">(</span><span class="n">hdf5_input</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kpoints</span><span class="o">.</span><span class="n">from_hdf</span><span class="p">(</span><span class="n">hdf5_input</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">potcar</span><span class="o">.</span><span class="n">from_hdf</span><span class="p">(</span><span class="n">hdf5_input</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_eddrmm</span> <span class="o">=</span> <span class="s2">&quot;ignore&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;vasp_dict&quot;</span> <span class="ow">in</span> <span class="n">hdf5_input</span><span class="o">.</span><span class="n">list_nodes</span><span class="p">():</span>
                <span class="n">vasp_dict</span> <span class="o">=</span> <span class="n">hdf5_input</span><span class="p">[</span><span class="s2">&quot;vasp_dict&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="s2">&quot;eddrmm_handling&quot;</span> <span class="ow">in</span> <span class="n">vasp_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_eddrmm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eddrmm_backwards_compatibility</span><span class="p">(</span><span class="n">vasp_dict</span><span class="p">[</span><span class="s2">&quot;eddrmm_handling&quot;</span><span class="p">])</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_eddrmm_backwards_compatibility</span><span class="p">(</span><span class="n">eddrmm_value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;On 9-03-2020, the EDDRMM flag &#39;not_converged&#39; was switched to &#39;warn&#39;.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">eddrmm_value</span> <span class="o">==</span> <span class="s1">&#39;not_converged&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;warn&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">eddrmm_value</span></div>


<div class="viewcode-block" id="Output"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.Output">[docs]</a><span class="k">class</span> <span class="nc">Output</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Handles the output from a VASP simulation.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        electronic_structure: Gives the electronic structure of the system</span>
<span class="sd">        electrostatic_potential: Gives the electrostatic/local potential of the system</span>
<span class="sd">        charge_density: Gives the charge density of the system</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_structure</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span> <span class="o">=</span> <span class="n">Outcar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span> <span class="o">=</span> <span class="n">GenericOutput</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;This contains all the output static from this particular vasp run&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">charge_density</span> <span class="o">=</span> <span class="n">VaspVolumetricData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">electrostatic_potential</span> <span class="o">=</span> <span class="n">VaspVolumetricData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">procar</span> <span class="o">=</span> <span class="n">Procar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">electronic_structure</span> <span class="o">=</span> <span class="n">ElectronicStructure</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vp_new</span> <span class="o">=</span> <span class="n">Vr</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Getter for the output structure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_structure</span>

    <span class="nd">@structure</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atoms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setter for the output structure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_structure</span> <span class="o">=</span> <span class="n">atoms</span>

<div class="viewcode-block" id="Output.collect"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.Output.collect">[docs]</a>    <span class="k">def</span> <span class="nf">collect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">sorted_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collects output from the working directory</span>

<span class="sd">        Args:</span>
<span class="sd">            directory (str): Path to the directory</span>
<span class="sd">            sorted_indices (np.array/None):</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sorted_indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">vasp_sorter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">)</span>
        <span class="n">files_present</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="n">log_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">vasprun_working</span><span class="p">,</span> <span class="n">outcar_working</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="s2">&quot;OUTCAR&quot;</span> <span class="ow">in</span> <span class="n">files_present</span> <span class="ow">or</span> <span class="s2">&quot;vasprun.xml&quot;</span> <span class="ow">in</span> <span class="n">files_present</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Either the OUTCAR or vasprun.xml files need to be present&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;OUTCAR&quot;</span> <span class="ow">in</span> <span class="n">files_present</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;OUTCAR&quot;</span><span class="p">))</span>
            <span class="n">outcar_working</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s2">&quot;vasprun.xml&quot;</span> <span class="ow">in</span> <span class="n">files_present</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vp_new</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;vasprun.xml&quot;</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">VasprunError</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Unable to parse the vasprun.xml file. Will attempt to get data from OUTCAR&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If parsing the vasprun file does not throw an error, then set to True</span>
                <span class="n">vasprun_working</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">outcar_working</span><span class="p">:</span>
            <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span><span class="s2">&quot;temperatures&quot;</span><span class="p">]</span>
            <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;pressures&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span><span class="s2">&quot;pressures&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span><span class="s2">&quot;n_elect&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span>
                <span class="s2">&quot;n_elect&quot;</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span><span class="s2">&quot;magnetization&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">magnetization</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span><span class="s2">&quot;magnetization&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">final_magmoms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span><span class="s2">&quot;final_magmoms&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="c1"># magnetization[sorted_indices] = magnetization.copy()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">final_magmoms</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">final_magmoms</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">final_magmoms</span><span class="p">[:,</span> <span class="n">sorted_indices</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">final_magmoms</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">final_magmoms</span><span class="p">[:,</span> <span class="n">sorted_indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">final_magmoms</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span>
                    <span class="s2">&quot;magnetization&quot;</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">magnetization</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span>
                    <span class="s2">&quot;final_magmoms&quot;</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">final_magmoms</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">vasprun_working</span><span class="p">:</span>
            <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;forces&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_new</span><span class="o">.</span><span class="n">vasprun_dict</span><span class="p">[</span><span class="s2">&quot;forces&quot;</span><span class="p">]</span>
            <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;cells&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_new</span><span class="o">.</span><span class="n">vasprun_dict</span><span class="p">[</span><span class="s2">&quot;cells&quot;</span><span class="p">]</span>
            <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_new</span><span class="o">.</span><span class="n">vasprun_dict</span><span class="p">[</span><span class="s2">&quot;cells&quot;</span><span class="p">]</span>
            <span class="p">]</span>
            <span class="c1"># log_dict[&quot;total_energies&quot;] = self.vp_new.vasprun_dict[&quot;total_energies&quot;]</span>
            <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;energy_tot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_new</span><span class="o">.</span><span class="n">vasprun_dict</span><span class="p">[</span><span class="s2">&quot;total_energies&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;kinetic_energies&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_new</span><span class="o">.</span><span class="n">vasprun_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;energy_pot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;energy_tot&quot;</span><span class="p">]</span>
                    <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_new</span><span class="o">.</span><span class="n">vasprun_dict</span><span class="p">[</span><span class="s2">&quot;kinetic_energies&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;energy_pot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;energy_tot&quot;</span><span class="p">]</span>
            <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;steps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;energy_tot&quot;</span><span class="p">]))</span>
            <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_new</span><span class="o">.</span><span class="n">vasprun_dict</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">]</span>
            <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;forces&quot;</span><span class="p">][:,</span> <span class="n">sorted_indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;forces&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">][:,</span> <span class="n">sorted_indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;nij,njk-&gt;nik&#39;</span><span class="p">,</span>
                                              <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">],</span>
                                              <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;cells&quot;</span><span class="p">])</span>
            <span class="c1"># log_dict[&quot;scf_energies&quot;] = self.vp_new.vasprun_dict[&quot;scf_energies&quot;]</span>
            <span class="c1"># log_dict[&quot;scf_dipole_moments&quot;] = self.vp_new.vasprun_dict[&quot;scf_dipole_moments&quot;]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">electronic_structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_new</span><span class="o">.</span><span class="n">get_electronic_structure</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">electronic_structure</span><span class="o">.</span><span class="n">grand_dos_matrix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">electronic_structure</span><span class="o">.</span><span class="n">grand_dos_matrix</span><span class="p">[</span>
                    <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">sorted_indices</span><span class="p">,</span> <span class="p">:</span>
                <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electronic_structure</span><span class="o">.</span><span class="n">grand_dos_matrix</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">electronic_structure</span><span class="o">.</span><span class="n">resolved_densities</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">electronic_structure</span><span class="o">.</span><span class="n">resolved_densities</span><span class="p">[</span>
                    <span class="p">:,</span> <span class="n">sorted_indices</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:</span>
                <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electronic_structure</span><span class="o">.</span><span class="n">resolved_densities</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">set_cell</span><span class="p">(</span><span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;cells&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">elif</span> <span class="n">outcar_working</span><span class="p">:</span>
            <span class="c1"># log_dict = self.outcar.parse_dict.copy()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span><span class="s2">&quot;energies&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">VaspCollectError</span><span class="p">(</span><span class="s2">&quot;Error in parsing OUTCAR&quot;</span><span class="p">)</span>
            <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;energy_tot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span><span class="s2">&quot;energies&quot;</span><span class="p">]</span>
            <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span><span class="s2">&quot;temperatures&quot;</span><span class="p">]</span>
            <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;pressures&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span><span class="s2">&quot;pressures&quot;</span><span class="p">]</span>
            <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;forces&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span><span class="s2">&quot;forces&quot;</span><span class="p">]</span>
            <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">]</span>
            <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;forces&quot;</span><span class="p">][:,</span> <span class="n">sorted_indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;forces&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">][:,</span> <span class="n">sorted_indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">VaspCollectError</span><span class="p">(</span><span class="s2">&quot;Improper OUTCAR parsing&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;positions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_indices</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">VaspCollectError</span><span class="p">(</span><span class="s2">&quot;Improper OUTCAR parsing&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;forces&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">VaspCollectError</span><span class="p">(</span><span class="s2">&quot;Improper OUTCAR parsing&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;forces&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_indices</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">VaspCollectError</span><span class="p">(</span><span class="s2">&quot;Improper OUTCAR parsing&quot;</span><span class="p">)</span>
            <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
            <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;steps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span><span class="s2">&quot;steps&quot;</span><span class="p">]</span>
            <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;cells&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span><span class="s2">&quot;cells&quot;</span><span class="p">]</span>
            <span class="n">log_dict</span><span class="p">[</span><span class="s2">&quot;volume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span><span class="s2">&quot;cells&quot;</span><span class="p">]]</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span>
                <span class="s2">&quot;scf_energy_free&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span><span class="s2">&quot;scf_energies&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span><span class="s2">&quot;scf_dipole_mom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span>
                <span class="s2">&quot;scf_dipole_moments&quot;</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span><span class="s2">&quot;n_elect&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span>
                <span class="s2">&quot;n_elect&quot;</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span><span class="s2">&quot;energy_int&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span>
                <span class="s2">&quot;energies_int&quot;</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span><span class="s2">&quot;energy_free&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span>
                <span class="s2">&quot;energies&quot;</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span><span class="s2">&quot;energy_zero&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span>
                <span class="s2">&quot;energies_zero&quot;</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;PROCAR&quot;</span> <span class="ow">in</span> <span class="n">files_present</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">electronic_structure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">procar</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span>
                        <span class="n">filename</span><span class="o">=</span><span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;PROCAR&quot;</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="c1">#  Even the atom resolved values have to be sorted from the vasp atoms order to the Atoms order</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">electronic_structure</span><span class="o">.</span><span class="n">grand_dos_matrix</span><span class="p">[</span>
                        <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">sorted_indices</span><span class="p">,</span> <span class="p">:</span>
                    <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electronic_structure</span><span class="o">.</span><span class="n">grand_dos_matrix</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">electronic_structure</span><span class="o">.</span><span class="n">efermi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">[</span>
                            <span class="s2">&quot;fermi_level&quot;</span>
                        <span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">electronic_structure</span><span class="o">.</span><span class="n">efermi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_new</span><span class="o">.</span><span class="n">vasprun_dict</span><span class="p">[</span>
                            <span class="s2">&quot;efermi&quot;</span>
                        <span class="p">]</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="c1"># important that we &quot;reverse sort&quot; the atoms in the vasp format into the atoms in the atoms class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">log_dict</span> <span class="o">=</span> <span class="n">log_dict</span>
        <span class="k">if</span> <span class="n">vasprun_working</span><span class="p">:</span>
            <span class="c1"># self.dft_output.log_dict[&quot;parameters&quot;] = self.vp_new.vasprun_dict[&quot;parameters&quot;]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span>
                <span class="s2">&quot;scf_dipole_mom&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_new</span><span class="o">.</span><span class="n">vasprun_dict</span><span class="p">[</span><span class="s2">&quot;scf_dipole_moments&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span><span class="s2">&quot;scf_dipole_mom&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">total_dipole_moments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">dip</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">dip</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span><span class="s2">&quot;scf_dipole_mom&quot;</span><span class="p">]</span>
                    <span class="p">]</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span><span class="s2">&quot;dipole_mom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_dipole_moments</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span>
                <span class="s2">&quot;scf_energy_int&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_new</span><span class="o">.</span><span class="n">vasprun_dict</span><span class="p">[</span><span class="s2">&quot;scf_energies&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span>
                <span class="s2">&quot;scf_energy_free&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_new</span><span class="o">.</span><span class="n">vasprun_dict</span><span class="p">[</span><span class="s2">&quot;scf_fr_energies&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span>
                <span class="s2">&quot;scf_energy_zero&quot;</span>
            <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_new</span><span class="o">.</span><span class="n">vasprun_dict</span><span class="p">[</span><span class="s2">&quot;scf_0_energies&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span><span class="s2">&quot;energy_int&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">e_int</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">e_int</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span><span class="s2">&quot;scf_energy_int&quot;</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span><span class="s2">&quot;energy_free&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">e_free</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">e_free</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span><span class="s2">&quot;scf_energy_free&quot;</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span><span class="s2">&quot;energy_zero&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">e_zero</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">e_zero</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span><span class="s2">&quot;scf_energy_zero&quot;</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span><span class="s2">&quot;n_elect&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vp_new</span><span class="o">.</span><span class="n">vasprun_dict</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">][</span><span class="s2">&quot;electronic&quot;</span><span class="p">][</span><span class="s2">&quot;NELECT&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;kinetic_energies&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_new</span><span class="o">.</span><span class="n">vasprun_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span>
                    <span class="s2">&quot;scf_energy_kin&quot;</span>
                <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vp_new</span><span class="o">.</span><span class="n">vasprun_dict</span><span class="p">[</span><span class="s2">&quot;kinetic_energies&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="s2">&quot;LOCPOT&quot;</span> <span class="ow">in</span> <span class="n">files_present</span>
            <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;LOCPOT&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">st_size</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">electrostatic_potential</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;LOCPOT&quot;</span><span class="p">),</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="s2">&quot;CHGCAR&quot;</span> <span class="ow">in</span> <span class="n">files_present</span>
            <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;CHGCAR&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">st_size</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">charge_density</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">posixpath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s2">&quot;CHGCAR&quot;</span><span class="p">),</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">bands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">electronic_structure</span></div>

<div class="viewcode-block" id="Output.to_hdf"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.Output.to_hdf">[docs]</a>    <span class="k">def</span> <span class="nf">to_hdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hdf</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the object in a HDF5 file</span>

<span class="sd">        Args:</span>
<span class="sd">            hdf (pyiron.base.generic.hdfio.ProjectHDFio): HDF path to which the object is to be saved</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">hdf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_output</span><span class="p">:</span>
            <span class="n">hdf5_output</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">hdf5_output</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">hdf5_output</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1"># with hdf5_output.open(&quot;vasprun&quot;) as hvr:</span>
            <span class="c1">#  if self.vasprun.dict_vasprun is not None:</span>
            <span class="c1">#     for key, val in self.vasprun.dict_vasprun.items():</span>
            <span class="c1">#        hvr[key] = val</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">electrostatic_potential</span><span class="o">.</span><span class="n">total_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">electrostatic_potential</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span>
                    <span class="n">hdf5_output</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="s2">&quot;electrostatic_potential&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_density</span><span class="o">.</span><span class="n">total_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">charge_density</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">hdf5_output</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="s2">&quot;charge_density&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">electronic_structure</span><span class="o">.</span><span class="n">kpoint_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">electronic_structure</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span>
                    <span class="n">hdf</span><span class="o">=</span><span class="n">hdf5_output</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="s2">&quot;electronic_structure&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">parse_dict</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">to_hdf_minimal</span><span class="p">(</span><span class="n">hdf</span><span class="o">=</span><span class="n">hdf5_output</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="s2">&quot;outcar&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Output.from_hdf"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.Output.from_hdf">[docs]</a>    <span class="k">def</span> <span class="nf">from_hdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hdf</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the attributes and reconstructs the object from a hdf file</span>
<span class="sd">        Args:</span>
<span class="sd">            hdf: The hdf5 instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">hdf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf5_output</span><span class="p">:</span>
            <span class="c1"># self.description = hdf5_output[&quot;description&quot;]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">structure</span> <span class="o">=</span> <span class="n">Atoms</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">from_hdf</span><span class="p">(</span><span class="n">hdf5_output</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generic_output</span><span class="o">.</span><span class="n">from_hdf</span><span class="p">(</span><span class="n">hdf5_output</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;electrostatic_potential&quot;</span> <span class="ow">in</span> <span class="n">hdf5_output</span><span class="o">.</span><span class="n">list_groups</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">electrostatic_potential</span><span class="o">.</span><span class="n">from_hdf</span><span class="p">(</span>
                        <span class="n">hdf5_output</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="s2">&quot;electrostatic_potential&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;charge_density&quot;</span> <span class="ow">in</span> <span class="n">hdf5_output</span><span class="o">.</span><span class="n">list_groups</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">charge_density</span><span class="o">.</span><span class="n">from_hdf</span><span class="p">(</span>
                        <span class="n">hdf5_output</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="s2">&quot;charge_density&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;electronic_structure&quot;</span> <span class="ow">in</span> <span class="n">hdf5_output</span><span class="o">.</span><span class="n">list_groups</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">electronic_structure</span><span class="o">.</span><span class="n">from_hdf</span><span class="p">(</span><span class="n">hdf</span><span class="o">=</span><span class="n">hdf5_output</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;outcar&quot;</span> <span class="ow">in</span> <span class="n">hdf5_output</span><span class="o">.</span><span class="n">list_groups</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">outcar</span><span class="o">.</span><span class="n">from_hdf</span><span class="p">(</span><span class="n">hdf</span><span class="o">=</span><span class="n">hdf5_output</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="s2">&quot;outcar&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IOError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="n">s</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Routine from_hdf() not completely successful&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="GenericOutput"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.GenericOutput">[docs]</a><span class="k">class</span> <span class="nc">GenericOutput</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    This class stores the generic output like different structures, energies and forces from a simulation in a highly</span>
<span class="sd">    generic format. Usually the user does not have to access this class.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        log_dict (dict): A dictionary of all tags and values of generic data (positions, forces, etc)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dft_log_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;generic_output contains generic output static&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bands</span> <span class="o">=</span> <span class="n">ElectronicStructure</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bands</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bands</span>

    <span class="nd">@bands</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">bands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bands</span> <span class="o">=</span> <span class="n">val</span>

<div class="viewcode-block" id="GenericOutput.to_hdf"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.GenericOutput.to_hdf">[docs]</a>    <span class="k">def</span> <span class="nf">to_hdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hdf</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the object in a HDF5 file</span>

<span class="sd">        Args:</span>
<span class="sd">            hdf (pyiron.base.generic.hdfio.ProjectHDFio): HDF path to which the object is to be saved</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">hdf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;generic&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf_go</span><span class="p">:</span>
            <span class="c1"># hdf_go[&quot;description&quot;] = self.description</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">hdf_go</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">with</span> <span class="n">hdf_go</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;dft&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf_dft</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">hdf_dft</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bands</span><span class="o">.</span><span class="n">eigenvalue_matrix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bands</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">hdf_dft</span><span class="p">,</span> <span class="s2">&quot;bands&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="GenericOutput.from_hdf"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.GenericOutput.from_hdf">[docs]</a>    <span class="k">def</span> <span class="nf">from_hdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hdf</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the attributes and reconstructs the object from a hdf file</span>
<span class="sd">        Args:</span>
<span class="sd">            hdf: The hdf5 instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">hdf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;generic&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf_go</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">hdf_go</span><span class="o">.</span><span class="n">list_nodes</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span>
                    <span class="c1"># self.description = hdf_go[node]</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_dict</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdf_go</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;dft&quot;</span> <span class="ow">in</span> <span class="n">hdf_go</span><span class="o">.</span><span class="n">list_groups</span><span class="p">():</span>
                <span class="k">with</span> <span class="n">hdf_go</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;dft&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf_dft</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">hdf_dft</span><span class="o">.</span><span class="n">list_nodes</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dft_log_dict</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdf_dft</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s2">&quot;bands&quot;</span> <span class="ow">in</span> <span class="n">hdf_dft</span><span class="o">.</span><span class="n">list_groups</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">bands</span><span class="o">.</span><span class="n">from_hdf</span><span class="p">(</span><span class="n">hdf_dft</span><span class="p">,</span> <span class="s2">&quot;bands&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="DFTOutput"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.DFTOutput">[docs]</a><span class="k">class</span> <span class="nc">DFTOutput</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class stores the DFT specific output</span>

<span class="sd">    Attributes:</span>
<span class="sd">        log_dict (dict): A dictionary of all tags and values of DFT data</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;contains DFT specific output&quot;</span>

<div class="viewcode-block" id="DFTOutput.to_hdf"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.DFTOutput.to_hdf">[docs]</a>    <span class="k">def</span> <span class="nf">to_hdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hdf</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the object in a HDF5 file</span>

<span class="sd">        Args:</span>
<span class="sd">            hdf (pyiron.base.generic.hdfio.ProjectHDFio): HDF path to which the object is to be saved</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">hdf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;dft&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf_dft</span><span class="p">:</span>
            <span class="c1"># hdf_go[&quot;description&quot;] = self.description</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">hdf_dft</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span></div>

<div class="viewcode-block" id="DFTOutput.from_hdf"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.DFTOutput.from_hdf">[docs]</a>    <span class="k">def</span> <span class="nf">from_hdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hdf</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the attributes and reconstructs the object from a hdf file</span>
<span class="sd">        Args:</span>
<span class="sd">            hdf: The hdf5 instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">hdf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;dft&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf_dft</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">hdf_dft</span><span class="o">.</span><span class="n">list_nodes</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span>
                    <span class="c1"># self.description = hdf_go[node]</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_dict</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">hdf_dft</span><span class="p">[</span><span class="n">node</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="Incar"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.Incar">[docs]</a><span class="k">class</span> <span class="nc">Incar</span><span class="p">(</span><span class="n">GenericParameters</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to control the INCAR file of a vasp simulation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;incar&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Incar</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">input_file_name</span><span class="o">=</span><span class="n">input_file_name</span><span class="p">,</span>
            <span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span>
            <span class="n">comment_char</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">,</span>
            <span class="n">separator_char</span><span class="o">=</span><span class="s2">&quot;=&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bool_dict</span> <span class="o">=</span> <span class="p">{</span><span class="kc">True</span><span class="p">:</span> <span class="s2">&quot;.TRUE.&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">:</span> <span class="s2">&quot;.FALSE.&quot;</span><span class="p">}</span>

<div class="viewcode-block" id="Incar.load_default"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.Incar.load_default">[docs]</a>    <span class="k">def</span> <span class="nf">load_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the default file content</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_content</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">SYSTEM =  ToDo  # jobname</span>
<span class="s2">PREC = Accurate</span>
<span class="s2">ALGO = Fast</span>
<span class="s2">LREAL = False</span>
<span class="s2">LWAVE = False</span>
<span class="s2">LORBIT = 0</span>
<span class="s2">&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_string</span><span class="p">(</span><span class="n">file_content</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Kpoints"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.Kpoints">[docs]</a><span class="k">class</span> <span class="nc">Kpoints</span><span class="p">(</span><span class="n">GenericParameters</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to control the KPOINTS file of a vasp simulation</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_file_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="s2">&quot;kpoints&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Kpoints</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">input_file_name</span><span class="o">=</span><span class="n">input_file_name</span><span class="p">,</span>
            <span class="n">table_name</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span>
            <span class="n">val_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">comment_char</span><span class="o">=</span><span class="s2">&quot;!&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_path</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Kpoints.set_kpoints_file"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.Kpoints.set_kpoints_file">[docs]</a>    <span class="k">def</span> <span class="nf">set_kpoints_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">size_of_mesh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets appropriate tags and values in the KPOINTS file</span>
<span class="sd">        Args:</span>
<span class="sd">            method (str): Type of meshing scheme (Gamma, MP, Manual or Line)</span>
<span class="sd">            size_of_mesh (list/numpy.ndarray): List of size 1x3 specifying the required mesh size</span>
<span class="sd">            shift (list): List of size 1x3 specifying the user defined shift from the Gamma point</span>
<span class="sd">            n_path (int): Number of points per trace for line mode</span>
<span class="sd">            path (list): List of tuples including path coorinate and name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;trace have to be defined&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">n_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="s2">&quot;rec&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">val</span> <span class="o">+</span> <span class="s2">&quot; !&quot;</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">size_of_mesh</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">size_of_mesh</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">shift</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">shift</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">val</span><span class="p">)</span></div>

<div class="viewcode-block" id="Kpoints.load_default"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.Kpoints.load_default">[docs]</a>    <span class="k">def</span> <span class="nf">load_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads the default file content</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_content</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">Kpoints file generated with pyiron</span>
<span class="s2">0</span>
<span class="s2">Monkhorst_Pack</span>
<span class="s2">4 4 4</span>
<span class="s2">0 0 0</span>
<span class="s2">&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_string</span><span class="p">(</span><span class="n">file_content</span><span class="p">)</span></div>

<div class="viewcode-block" id="Kpoints.set_kmesh_by_density"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.Kpoints.set_kmesh_by_density">[docs]</a>    <span class="k">def</span> <span class="nf">set_kmesh_by_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="s2">&quot;density_of_mesh&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s2">&quot;density_of_mesh&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s2">&quot;density_of_mesh&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">k_mesh</span> <span class="o">=</span> <span class="n">get_k_mesh_by_cell</span><span class="p">(</span>
                    <span class="n">structure</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(),</span>
                    <span class="n">kspace_per_in_ang</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_dataset</span><span class="p">[</span><span class="s2">&quot;density_of_mesh&quot;</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_kpoints_file</span><span class="p">(</span><span class="n">size_of_mesh</span><span class="o">=</span><span class="n">k_mesh</span><span class="p">)</span></div>

<div class="viewcode-block" id="Kpoints.to_hdf"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.Kpoints.to_hdf">[docs]</a>    <span class="k">def</span> <span class="nf">to_hdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hdf</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store the GenericParameters in an HDF5 file</span>

<span class="sd">        Args:</span>
<span class="sd">            hdf (ProjectHDFio): HDF5 group object</span>
<span class="sd">            group_name (str): HDF5 subgroup name - optional</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Kpoints</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span>
            <span class="n">hdf</span><span class="o">=</span><span class="n">hdf</span><span class="p">,</span>
            <span class="n">group_name</span><span class="o">=</span><span class="n">group_name</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">line_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;path_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_name</span><span class="p">,</span>
                         <span class="s2">&quot;n_path&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_path</span><span class="p">}</span>
            <span class="k">with</span> <span class="n">hdf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;kpoints&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf_kpoints</span><span class="p">:</span>
                <span class="n">hdf_kpoints</span><span class="p">[</span><span class="s2">&quot;line_dict&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line_dict</span></div>

<div class="viewcode-block" id="Kpoints.from_hdf"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.Kpoints.from_hdf">[docs]</a>    <span class="k">def</span> <span class="nf">from_hdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hdf</span><span class="p">,</span> <span class="n">group_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restore the GenericParameters from an HDF5 file</span>

<span class="sd">        Args:</span>
<span class="sd">            hdf (ProjectHDFio): HDF5 group object</span>
<span class="sd">            group_name (str): HDF5 subgroup name - optional</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Kpoints</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">from_hdf</span><span class="p">(</span>
            <span class="n">hdf</span><span class="o">=</span><span class="n">hdf</span><span class="p">,</span>
            <span class="n">group_name</span><span class="o">=</span><span class="n">group_name</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="n">hdf</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;kpoints&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdf_kpoints</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;line_dict&quot;</span> <span class="ow">in</span> <span class="n">hdf_kpoints</span><span class="o">.</span><span class="n">list_nodes</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_path_name</span> <span class="o">=</span> <span class="n">hdf_kpoints</span><span class="p">[</span><span class="s2">&quot;line_dict&quot;</span><span class="p">][</span><span class="s2">&quot;path_name&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_n_path</span> <span class="o">=</span> <span class="n">hdf_kpoints</span><span class="p">[</span><span class="s2">&quot;line_dict&quot;</span><span class="p">][</span><span class="s2">&quot;n_path&quot;</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="get_k_mesh_by_cell"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.get_k_mesh_by_cell">[docs]</a><span class="k">def</span> <span class="nf">get_k_mesh_by_cell</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">kspace_per_in_ang</span><span class="o">=</span><span class="mf">0.10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        cell:</span>
<span class="sd">        kspace_per_in_ang:</span>
<span class="sd">    Returns:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">latlens</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">cell</span><span class="p">]</span>
    <span class="n">kmesh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">ll</span> <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">latlens</span><span class="p">])</span> <span class="o">/</span> <span class="n">kspace_per_in_ang</span><span class="p">)</span>
    <span class="n">kmesh</span><span class="p">[</span><span class="n">kmesh</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">kmesh</span></div>


<div class="viewcode-block" id="VaspCollectError"><a class="viewcode-back" href="../../../apidoc/pyiron.vasp.base.html#pyiron.vasp.base.VaspCollectError">[docs]</a><span class="k">class</span> <span class="nc">VaspCollectError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
    <span class="k">pass</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, Max-Planck-Institut f端r Eisenforschung GmbH - Computational Materials Design (CM) Department All rights reserved

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>